<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Document Picture-in-Picture Specification</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version d765c696b, updated Fri Mar 8 15:58:52 2024 -0800" name="generator">
  <link href="https://wicg.github.io/document-picture-in-picture/" rel="canonical">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
[data-algorithm] var { cursor: pointer; }
var[data-var-color="0"] { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
var[data-var-color="1"] { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
var[data-var-color="2"] { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
var[data-var-color="3"] { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
var[data-var-color="4"] { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
var[data-var-color="5"] { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
var[data-var-color="6"] { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Document Picture-in-Picture Specification</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2024-03-13">13 March 2024</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://wicg.github.io/document-picture-in-picture/">https://wicg.github.io/document-picture-in-picture/</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/document-picture-in-picture/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:steimel@google.com">Tommy Steimel</a> (<span class="p-org org">Google Inc.</span>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2024 the Contributors to the Document Picture-in-Picture Specification Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification enables web developers to populate an HTMLDocument
in an always-on-top window.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#dependencies"><span class="secno">2</span> <span class="content">Dependencies</span></a>
    <li>
     <a href="#security-considerations"><span class="secno">3</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#secure-context"><span class="secno">3.1</span> <span class="content">Secure Context</span></a>
      <li>
       <a href="#spoofing"><span class="secno">3.2</span> <span class="content">Spoofing</span></a>
       <ol class="toc">
        <li><a href="#positioning"><span class="secno">3.2.1</span> <span class="content">Positioning</span></a>
        <li><a href="#origin-visibility"><span class="secno">3.2.2</span> <span class="content">Origin Visibility</span></a>
        <li><a href="#maximum-size"><span class="secno">3.2.3</span> <span class="content">Maximum size</span></a>
       </ol>
      <li><a href="#iframes"><span class="secno">3.3</span> <span class="content">IFrames</span></a>
     </ol>
    <li>
     <a href="#privacy-considerations"><span class="secno">4</span> <span class="content">Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#fingerprinting"><span class="secno">4.1</span> <span class="content">Fingerprinting</span></a>
     </ol>
    <li><a href="#api"><span class="secno">5</span> <span class="content">API</span></a>
    <li>
     <a href="#concepts"><span class="secno">6</span> <span class="content">Concepts</span></a>
     <ol class="toc">
      <li><a href="#pip-support"><span class="secno">6.1</span> <span class="content">Document Picture-in-Picture Support</span></a>
      <li><a href="#is-document-picture-in-picture-window"><span class="secno">6.2</span> <span class="content">DocumentPictureInPicture Window</span></a>
      <li><a href="#close-document-pip-window"><span class="secno">6.3</span> <span class="content">Closing a Document Picture-in-Picture window</span></a>
      <li><a href="#close-existing-pip-windows"><span class="secno">6.4</span> <span class="content">Close any existing PiP windows</span></a>
      <li><a href="#one-pip-window"><span class="secno">6.5</span> <span class="content">One PiP Window</span></a>
      <li><a href="#close-on-destroy"><span class="secno">6.6</span> <span class="content">Closing the PiP window when either the original or PiP document is destroyed</span></a>
      <li><a href="#close-on-navigate"><span class="secno">6.7</span> <span class="content">Closing the PiP window when either the original or PiP document is navigated</span></a>
      <li><a href="#resizing-the-pip-window"><span class="secno">6.8</span> <span class="content">Resizing the PiP window</span></a>
      <li><a href="#focusing-the-opener-window"><span class="secno">6.9</span> <span class="content">Focusing the opener window</span></a>
      <li><a href="#css-display-mode"><span class="secno">6.10</span> <span class="content">CSS display-mode</span></a>
     </ol>
    <li>
     <a href="#examples"><span class="secno">7</span> <span class="content">Examples</span></a>
     <ol class="toc">
      <li>
       <a href="#example-video-player"><span class="secno">7.1</span> <span class="content">Extracting a video player into PiP</span></a>
       <ol class="toc">
        <li><a href="#example-video-player-html"><span class="secno">7.1.1</span> <span class="content">HTML</span></a>
        <li><a href="#example-video-player-js"><span class="secno">7.1.2</span> <span class="content">JavaScript</span></a>
       </ol>
      <li><a href="#example-access-elements"><span class="secno">7.2</span> <span class="content">Accessing elements on the PiP Window</span></a>
      <li><a href="#example-listen-events"><span class="secno">7.3</span> <span class="content">Listening to events on the PiP Window</span></a>
      <li><a href="#example-exiting-pip"><span class="secno">7.4</span> <span class="content">Exiting PiP</span></a>
      <li><a href="#example-elements-out-on-close"><span class="secno">7.5</span> <span class="content">Getting elements out of the PiP window when it closes</span></a>
      <li><a href="#example-programmatic-resize"><span class="secno">7.6</span> <span class="content">Programatically resize the PiP window</span></a>
      <li><a href="#example-return-to-tab"><span class="secno">7.7</span> <span class="content">Return to the opener tab</span></a>
      <li><a href="#example-display-mode"><span class="secno">7.8</span> <span class="content">CSS picture-in-picture display mode usage</span></a>
      <li><a href="#example-hide-return-to-opener"><span class="secno">7.9</span> <span class="content">Hide return-to-opener button</span></a>
     </ol>
    <li><a href="#acknowledgments"><span class="secno">8</span> <span class="content">Acknowledgments</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>There currently exists a Web API for putting an <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/media.html#htmlvideoelement" id="ref-for-htmlvideoelement">HTMLVideoElement</a></code> into a
Picture-in-Picture window (<code>requestPictureInPicture()</code>). This limits
a website’s ability to provide a custom picture-in-picture experience (PiP). We
want to expand upon that functionality by providing the website with a full <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> on an always-on-top window.</p>
   <p>This new window will be much like a blank same-origin window opened via the
existing <a class="idl-code" data-link-type="method" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-open" id="ref-for-dom-open">open()</a> method on <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code>, with some minor
differences:</p>
   <ul>
    <li data-md>
     <p>The PiP window will float on top of other windows.</p>
    <li data-md>
     <p>The PiP window will never outlive the opening window.</p>
    <li data-md>
     <p>The website cannot set the position of the PiP window.</p>
    <li data-md>
     <p>The PiP window cannot be navigated (any `window.history` or `window.location`
calls that change to a new document will close the PiP window).</p>
   </ul>
   <h2 class="heading settled" data-level="2" id="dependencies"><span class="secno">2. </span><span class="content">Dependencies</span><a class="self-link" href="#dependencies"></a></h2>
   <p>The IDL fragments in this specification must be interpreted as required for
conforming IDL fragments, as described in the Web IDL specification. <a data-link-type="biblio" href="#biblio-webidl" title="Web IDL Standard">[WEBIDL]</a></p>
   <h2 class="heading settled" data-level="3" id="security-considerations"><span class="secno">3. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="secure-context"><span class="secno">3.1. </span><span class="content">Secure Context</span><a class="self-link" href="#secure-context"></a></h3>
   <p>The API is limited to <a data-link-type="biblio" href="#biblio-secure-contexts" title="Secure Contexts">[SECURE-CONTEXTS]</a>.</p>
   <h3 class="heading settled" data-level="3.2" id="spoofing"><span class="secno">3.2. </span><span class="content">Spoofing</span><a class="self-link" href="#spoofing"></a></h3>
   <p>It is required that the user agent provides enough UI on the <code class="idl"><a data-link-type="idl" href="#documentpictureinpicture" id="ref-for-documentpictureinpicture">DocumentPictureInPicture</a></code> window to prevent malicious websites from abusing
the ability to float on top of other windows to spoof other websites or system
UI.</p>
   <h4 class="heading settled" data-level="3.2.1" id="positioning"><span class="secno">3.2.1. </span><span class="content">Positioning</span><a class="self-link" href="#positioning"></a></h4>
   <p>The user agent must prevent the website from setting the position of the window
in order to prevent the website from purposefully positioning the window in a
location that may trick a user into thinking it is part of another page’s UI. In
particular, this means the <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-moveto" id="ref-for-dom-window-moveto">moveTo()</a></code> and <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-moveby" id="ref-for-dom-window-moveby">moveBy()</a></code> APIs must
be disabled for document picture-in-picture windows.</p>
   <h4 class="heading settled" data-level="3.2.2" id="origin-visibility"><span class="secno">3.2.2. </span><span class="content">Origin Visibility</span><a class="self-link" href="#origin-visibility"></a></h4>
   <p>It is required that the user agent makes it clear to the user which origin is
controlling the <code class="idl"><a data-link-type="idl" href="#documentpictureinpicture" id="ref-for-documentpictureinpicture①">DocumentPictureInPicture</a></code> window at all times to ensure that
the user is aware of where the content is coming from. For example, the user
agent may display the origin of the website in a titlebar on the window.</p>
   <h4 class="heading settled" data-level="3.2.3" id="maximum-size"><span class="secno">3.2.3. </span><span class="content">Maximum size</span><a class="self-link" href="#maximum-size"></a></h4>
   <p>The user agent should restrict the maximum size of the document
picture-in-picture window to prevent the website from covering the screen with
an always-on-top window and locking the user in the picture-in-picture window.
This also helps prevent spoofing the user’s desktop.</p>
   <h3 class="heading settled" data-level="3.3" id="iframes"><span class="secno">3.3. </span><span class="content">IFrames</span><a class="self-link" href="#iframes"></a></h3>
   <p>This API is only available on a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top">top-level traversable</a>. However, the <code class="idl"><a data-link-type="idl" href="#documentpictureinpicture" id="ref-for-documentpictureinpicture②">DocumentPictureInPicture</a></code> <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①">Window</a></code> itself may contain <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement" id="ref-for-htmliframeelement">HTMLIFrameElement</a></code>s, even <a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin">cross-origin</a> <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement" id="ref-for-htmliframeelement①">HTMLIFrameElement</a></code>s.</p>
   <h2 class="heading settled" data-level="4" id="privacy-considerations"><span class="secno">4. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy-considerations"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="fingerprinting"><span class="secno">4.1. </span><span class="content">Fingerprinting</span><a class="self-link" href="#fingerprinting"></a></h3>
   <p>When a PiP window is closed and then later re-opened, it can be useful for the
user agent to re-use size and location of the previous PiP window to provide a
smoother user experience. However, it is recommended that the user agent does
not re-use size/location across different origins as this may provide malicious
websites an avenue for fingerprinting a user.</p>
   <h2 class="heading settled" data-level="5" id="api"><span class="secno">5. </span><span class="content">API</span><a class="self-link" href="#api"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window②"><c- g>Window</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#documentpictureinpicture" id="ref-for-documentpictureinpicture③"><c- n>DocumentPictureInPicture</c-></a>
    <a class="idl-code" data-link-type="attribute" data-readonly data-type="DocumentPictureInPicture" href="#dom-window-documentpictureinpicture" id="ref-for-dom-window-documentpictureinpicture"><c- g>documentPictureInPicture</c-></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>Window</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext①"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="documentpictureinpicture"><code><c- g>DocumentPictureInPicture</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget"><c- n>EventTarget</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#NewObject" id="ref-for-NewObject"><c- g>NewObject</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window③"><c- n>Window</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-documentpictureinpicture-requestwindow" id="ref-for-dom-documentpictureinpicture-requestwindow"><c- g>requestWindow</c-></a>(
    <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-documentpictureinpictureoptions" id="ref-for-dictdef-documentpictureinpictureoptions"><c- n>DocumentPictureInPictureOptions</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="DocumentPictureInPicture/requestWindow(options), DocumentPictureInPicture/requestWindow()" data-dfn-type="argument" data-export id="dom-documentpictureinpicture-requestwindow-options-options"><code><c- g>options</c-></code></dfn> = {});
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window④"><c- n>Window</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="Window" href="#dom-documentpictureinpicture-window" id="ref-for-dom-documentpictureinpicture-window"><c- g>window</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="DocumentPictureInPicture" data-dfn-type="attribute" data-export data-type="EventHandler" id="dom-documentpictureinpicture-onenter"><code><c- g>onenter</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-documentpictureinpictureoptions"><code><c- g>DocumentPictureInPictureOptions</c-></code></dfn> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange" id="ref-for-EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-default="0" data-dfn-for="DocumentPictureInPictureOptions" data-dfn-type="dict-member" data-export data-type="unsigned long long" id="dom-documentpictureinpictureoptions-width"><code><c- g>width</c-></code></dfn> = 0;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange" id="ref-for-EnforceRange①"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long①"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-default="0" data-dfn-for="DocumentPictureInPictureOptions" data-dfn-type="dict-member" data-export data-type="unsigned long long" id="dom-documentpictureinpictureoptions-height"><code><c- g>height</c-></code></dfn> = 0;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="dfn-paneled idl-code" data-default="true" data-dfn-for="DocumentPictureInPictureOptions" data-dfn-type="dict-member" data-export data-type="boolean" id="dom-documentpictureinpictureoptions-allowreturntoopener"><code><c- g>allowReturnToOpener</c-></code></dfn> = <c- b>true</c->;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>Window</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext②"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="documentpictureinpictureevent"><code><c- g>DocumentPictureInPictureEvent</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event"><c- n>Event</c-></a> {
  <dfn class="dfn-paneled idl-code" data-dfn-for="DocumentPictureInPictureEvent" data-dfn-type="constructor" data-export data-lt="DocumentPictureInPictureEvent(type, eventInitDict)|constructor(type, eventInitDict)" id="dom-documentpictureinpictureevent-documentpictureinpictureevent"><code><c- g>constructor</c-></code></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="DocumentPictureInPictureEvent/DocumentPictureInPictureEvent(type, eventInitDict), DocumentPictureInPictureEvent/constructor(type, eventInitDict)" data-dfn-type="argument" data-export id="dom-documentpictureinpictureevent-documentpictureinpictureevent-type-eventinitdict-type"><code><c- g>type</c-></code></dfn>, <a data-link-type="idl-name" href="#dictdef-documentpictureinpictureeventinit" id="ref-for-dictdef-documentpictureinpictureeventinit"><c- n>DocumentPictureInPictureEventInit</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="DocumentPictureInPictureEvent/DocumentPictureInPictureEvent(type, eventInitDict), DocumentPictureInPictureEvent/constructor(type, eventInitDict)" data-dfn-type="argument" data-export id="dom-documentpictureinpictureevent-documentpictureinpictureevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code></dfn>);
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject①"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑤"><c- n>Window</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="DocumentPictureInPictureEvent" data-dfn-type="attribute" data-export data-readonly data-type="Window" id="dom-documentpictureinpictureevent-window"><code><c- g>window</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-documentpictureinpictureeventinit"><code><c- g>DocumentPictureInPictureEventInit</c-></code></dfn> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit" id="ref-for-dictdef-eventinit"><c- n>EventInit</c-></a> {
  <c- b>required</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑥"><c- n>Window</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="DocumentPictureInPictureEventInit" data-dfn-type="dict-member" data-export data-type="Window" id="dom-documentpictureinpictureeventinit-window"><code><c- g>window</c-></code></dfn>;
};
</pre>
   <p> A <code class="idl"><a data-link-type="idl" href="#documentpictureinpicture" id="ref-for-documentpictureinpicture④">DocumentPictureInPicture</a></code> object allows websites to create and open a new
always-on-top <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑦">Window</a></code> as well as listen for events related to opening and
closing that <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑧">Window</a></code>. </p>
   <p>Each <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑨">Window</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="Window" data-dfn-type="dfn" data-noexport id="window-documentpictureinpicture-api">documentPictureInPicture API</dfn>,
which is a new <code class="idl"><a data-link-type="idl" href="#documentpictureinpicture" id="ref-for-documentpictureinpicture⑤">DocumentPictureInPicture</a></code> instance created alongside the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①⓪">Window</a></code>.</p>
   <div class="algorithm" data-algorithm="documentPictureInPicture" data-algorithm-for="Window">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="Window" data-dfn-type="attribute" data-export id="dom-window-documentpictureinpicture"><code>documentPictureInPicture</code></dfn> getter steps are: 
    <ol>
     <li data-md>
      <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>’s <a data-link-type="dfn" href="#window-documentpictureinpicture-api" id="ref-for-window-documentpictureinpicture-api">documentPictureInPicture API</a>.</p>
    </ol>
   </div>
   <p>Each <code class="idl"><a data-link-type="idl" href="#documentpictureinpicture" id="ref-for-documentpictureinpicture⑥">DocumentPictureInPicture</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="DocumentPictureInPicture" data-dfn-type="dfn" data-noexport id="documentpictureinpicture-last-opened-window">last-opened window</dfn> which is a <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①①">Window</a></code> object that is initially <code>null</code> and is set as part of the <a data-link-type="functionish" href="#dom-documentpictureinpicture-requestwindow" id="ref-for-dom-documentpictureinpicture-requestwindow①">requestWindow()</a> method steps.</p>
   <div class="algorithm" data-algorithm="window" data-algorithm-for="DocumentPictureInPicture">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="DocumentPictureInPicture" data-dfn-type="attribute" data-export id="dom-documentpictureinpicture-window"><code>window</code></dfn> getter steps are: 
    <ol>
     <li data-md>
      <p>Let <var>win</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>’s <a data-link-type="dfn" href="#documentpictureinpicture-last-opened-window" id="ref-for-documentpictureinpicture-last-opened-window">last-opened window</a>.</p>
     <li data-md>
      <p>If <var>win</var> is not <code>null</code> and <var>win</var>’s <a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-closed" id="ref-for-dom-window-closed">closed</a> attribute is <code>false</code>, return <var>win</var>.</p>
     <li data-md>
      <p>Return <code>null</code>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="requestWindow(options)" data-algorithm-for="DocumentPictureInPicture">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="DocumentPictureInPicture" data-dfn-type="method" data-export data-lt="requestWindow(options)|requestWindow()" id="dom-documentpictureinpicture-requestwindow"><code>requestWindow(options)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>If <a data-link-type="dfn" href="#document-picture-in-picture-support" id="ref-for-document-picture-in-picture-support">Document Picture-in-Picture support</a> is <code>false</code>, throw a
"<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notsupportederror" id="ref-for-notsupportederror">NotSupportedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable" id="ref-for-window-navigable">navigable</a> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top①">top-level traversable</a>, throw a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable" id="ref-for-window-navigable①">navigable</a>’s <a data-link-type="dfn" href="#is-document-picture-in-picture" id="ref-for-is-document-picture-in-picture">Is Document Picture-in-Picture</a> boolean is <code>true</code>, throw a
"<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror①">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
     <li data-md>
      <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global②">relevant global object</a> does not have <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation">transient activation</a>, throw a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror②">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-width" id="ref-for-dom-documentpictureinpictureoptions-width">width</a></code>"] exists and is greater than zero, but <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-height" id="ref-for-dom-documentpictureinpictureoptions-height">height</a></code>"] does not exist or is zero, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror">RangeError</a></code>.</p>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-height" id="ref-for-dom-documentpictureinpictureoptions-height①">height</a></code>"] exists and is greater than zero, but <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-width" id="ref-for-dom-documentpictureinpictureoptions-width①">width</a></code>"] does not exist or is zero, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror①">RangeError</a></code>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation" id="ref-for-consume-user-activation">Consume user activation</a> given <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑤">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global③">relevant global object</a>.</p>
     <li data-md>
      <p>Let <var>win</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a>’s <a data-link-type="dfn" href="#documentpictureinpicture-last-opened-window" id="ref-for-documentpictureinpicture-last-opened-window①">last-opened window</a>. If <var>win</var> is not <code>null</code> and <var>win</var>’s <a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-closed" id="ref-for-dom-window-closed①">closed</a> attribute is <code>false</code>, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/#close-a-top-level-traversable">close</a> <var>win</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable" id="ref-for-window-navigable②">navigable</a>.</p>
     <li data-md>
      <p>Optionally, the user agent can <a data-link-type="dfn" href="#close-any-existing-picture-in-picture-windows" id="ref-for-close-any-existing-picture-in-picture-windows">close any existing picture-in-picture windows</a>.</p>
     <li data-md>
      <p>Set <var>pip traversable</var> to be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#creating-a-new-top-level-traversable">creating a new top-level traversable</a> given <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑦">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global④">relevant global object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable" id="ref-for-window-navigable③">navigable</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc" id="ref-for-nav-bc">active browsing context</a> and "<code>_blank</code>".</p>
    </ol>
    <p class="note" role="note"> The resulting <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document①">Document</a></code>'s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document-url" id="ref-for-concept-document-url">URL</a> will be `about:blank`, but its <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/urls-and-fetching.html#document-base-url" id="ref-for-document-base-url">document base URL</a> will fall back to be that of the initiator that called <code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpicture-requestwindow" id="ref-for-dom-documentpictureinpicture-requestwindow②">requestWindow()</a></code>. Some browsers do not implement
this fallback behavior for normal `about:blank` popups; see <a href="https://github.com/whatwg/html/issues/421">whatwg/html#421</a> for
discussion. Implementers are advised to make sure this inheritance happens as
specified for document picture-in-picture windows, to avoid further interop
problems. </p>
    <ol start="11">
     <li data-md>
      <p>Set <var>pip traversable</var>’s <a data-link-type="dfn" href="#is-document-picture-in-picture" id="ref-for-is-document-picture-in-picture①">Is Document Picture-in-Picture</a> boolean to <code>true</code>.</p>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-width" id="ref-for-dom-documentpictureinpictureoptions-width②">width</a></code>"] exists and is
greater than zero:</p>
      <ol>
       <li data-md>
        <p>Optionally, clamp or ignore <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-width" id="ref-for-dom-documentpictureinpictureoptions-width③">width</a></code>"] if it is too large or too
small in order to fit a user-friendly window size.</p>
       <li data-md>
        <p>Optionally, size <var>pip traversable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc" id="ref-for-nav-bc①">active browsing context</a>’s
window such that the distance between the left and right edges of the
viewport are <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-width" id="ref-for-dom-documentpictureinpictureoptions-width④">width</a></code>"]
pixels.</p>
      </ol>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-height" id="ref-for-dom-documentpictureinpictureoptions-height②">height</a></code>"] exists and is
greater than zero:</p>
      <ol>
       <li data-md>
        <p>Optionally, clamp or ignore <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-height" id="ref-for-dom-documentpictureinpictureoptions-height③">height</a></code>"] if it is too large or too
small in order to fit a user-friendly window size.</p>
       <li data-md>
        <p>Optionally, size <var>pip traversable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc" id="ref-for-nav-bc②">active browsing context</a>’s
window such that the distance between the top and bottom edges of the
viewport are <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-height" id="ref-for-dom-documentpictureinpictureoptions-height④">height</a></code>"]
pixels.</p>
      </ol>
     <li data-md>
      <p>If <var>options</var>["<code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-allowreturntoopener" id="ref-for-dom-documentpictureinpictureoptions-allowreturntoopener">allowReturnToOpener</a></code>"] exists
and is <code>false</code>, the user agent should not display UI affordances
on the picture-in-picture window that allow the user to return to the
opener window.</p>
    </ol>
    <p class="note" role="note"> For both video and document picture-in-picture, user agents often display a
button for the user to return to the original page and close the
picture-in-picture window. While this action makes sense in most cases
(especially for a video picture-in-picture window that returns the video to the
main document), it does not always make sense for document picture-in-picture
windows. <code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-allowreturntoopener" id="ref-for-dom-documentpictureinpictureoptions-allowreturntoopener①">allowReturnToOpener</a></code> is a hint to the
user agent from the website as to whether that action makes sense for their
particular document picture-in-picture experience. </p>
    <ol start="15">
     <li data-md>
      <p>Configure <var>pip traversable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc" id="ref-for-nav-bc③">active browsing context</a>’s window to
float on top of other windows.</p>
     <li data-md>
      <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑧">this</a>’s <a data-link-type="dfn" href="#documentpictureinpicture-last-opened-window" id="ref-for-documentpictureinpicture-last-opened-window②">last-opened window</a> to <var>pip traversable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window" id="ref-for-nav-window">active window</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task">Queue a global task</a> on the <a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source">DOM manipulation task source</a> given <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑨">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑤">relevant global object</a> to <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire">fire an event</a> named <code class="idl"><a data-link-type="idl" href="#eventdef-documentpictureinpicture-enter" id="ref-for-eventdef-documentpictureinpicture-enter">enter</a></code> using <code class="idl"><a data-link-type="idl" href="#documentpictureinpictureevent" id="ref-for-documentpictureinpictureevent">DocumentPictureInPictureEvent</a></code> on <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⓪">this</a> with its <code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureevent-window" id="ref-for-dom-documentpictureinpictureevent-window">window</a></code> attribute
initialized to <var>pip traversable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window" id="ref-for-nav-window①">active window</a>.</p>
     <li data-md>
      <p>Return <var>pip traversable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window" id="ref-for-nav-window②">active window</a>.</p>
    </ol>
   </div>
   <p class="note" role="note"> While the size of the window can be configured by the website, the initial
position is left to the discretion of the user agent. </p>
   <p></p>
   <dl>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="DocumentPictureInPicture" data-dfn-type="event" data-export id="eventdef-documentpictureinpicture-enter"><code>enter</code></dfn>
    <dd data-md>
     <p>Fired on <code class="idl"><a data-link-type="idl" href="#documentpictureinpicture" id="ref-for-documentpictureinpicture⑦">DocumentPictureInPicture</a></code> when a PiP window is opened.</p>
   </dl>
   <h2 class="heading settled" data-level="6" id="concepts"><span class="secno">6. </span><span class="content">Concepts</span><a class="self-link" href="#concepts"></a></h2>
   <h3 class="heading settled" data-level="6.1" id="pip-support"><span class="secno">6.1. </span><span class="content">Document Picture-in-Picture Support</span><a class="self-link" href="#pip-support"></a></h3>
   <p>Each user agent has a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="document-picture-in-picture-support">Document Picture-in-Picture Support</dfn> boolean,
whose value is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#implementation-defined" id="ref-for-implementation-defined">implementation-defined</a> (and might vary according to user
preferences).</p>
   <h3 class="heading settled" data-level="6.2" id="is-document-picture-in-picture-window"><span class="secno">6.2. </span><span class="content">DocumentPictureInPicture Window</span><a class="self-link" href="#is-document-picture-in-picture-window"></a></h3>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top②">top-level traversable</a> has an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="is-document-picture-in-picture">Is Document Picture-in-Picture</dfn> boolean, whose value defaults to <code>false</code>, but can be set to <code>true</code> in the <a data-link-type="functionish" href="#dom-documentpictureinpicture-requestwindow" id="ref-for-dom-documentpictureinpicture-requestwindow③">requestWindow()</a> method steps.</p>
   <h3 class="heading settled" data-level="6.3" id="close-document-pip-window"><span class="secno">6.3. </span><span class="content">Closing a Document Picture-in-Picture window</span><a class="self-link" href="#close-document-pip-window"></a></h3>
   <p class="issue" id="issue-52892068"><a class="self-link" href="#issue-52892068"></a> Merge this into <a data-link-type="dfn" href="https://html.spec.whatwg.org/#close-a-top-level-traversable">close</a> once it has enough consensus. </p>
   <p>Modify step 2 of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#close-a-top-level-traversable">close</a>,
"If the result of checking if unloading is user-canceled for toUnload is true,
then return." to be:</p>
   <ol start="2">
    <li data-md>
     <p>If <var>traversable</var>’s <a data-link-type="dfn" href="#is-document-picture-in-picture" id="ref-for-is-document-picture-in-picture②">Is Document Picture-in-Picture</a> boolean is
true, then skip this step. Otherwise, if the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#checking-if-unloading-is-user-canceled">checking if unloading is user-canceled</a> for toUnload is true, then return.</p>
   </ol>
   <h3 class="heading settled" data-level="6.4" id="close-existing-pip-windows"><span class="secno">6.4. </span><span class="content">Close any existing PiP windows</span><a class="self-link" href="#close-existing-pip-windows"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="close-any-existing-picture-in-picture-windows">close any existing picture-in-picture windows</dfn>:</p>
   <ol>
    <li data-md>
     <p>For each <var>top-level traversable</var> of the user agent’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/#top-level-traversable-set">top-level traversable set</a>:</p>
     <ol>
      <li data-md>
       <p>If <var>top-level traversable</var>’s <a data-link-type="dfn" href="#is-document-picture-in-picture" id="ref-for-is-document-picture-in-picture③">Is Document Picture-in-Picture</a> boolean is <code>true</code>, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/#close-a-top-level-traversable">close</a> <var>top-level traversable</var>.</p>
      <li data-md>
       <p>If <var>top-level traversable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document">active document</a>’s <a data-link-type="idl" href="https://w3c.github.io/picture-in-picture/#dom-documentorshadowroot-pictureinpictureelement">pictureInPictureElement</a> is not <code>null</code>, run the <a data-link-type="dfn" href="https://w3c.github.io/picture-in-picture/#exit-picture-in-picture-algorithm">exit Picture-in-Picture algorithm</a> with <var>top-level traversable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document①">active document</a>.</p>
      <li data-md>
       <p>For each <var>navigable</var> of <var>top-level traversable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document②">active document</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#descendant-navigables" id="ref-for-descendant-navigables">descendant navigables</a>:</p>
       <ol>
        <li data-md>
         <p>If <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document③">active document</a>’s <a data-link-type="idl" href="https://w3c.github.io/picture-in-picture/#dom-documentorshadowroot-pictureinpictureelement">pictureInPictureElement</a> is not <code>null</code>, run the <a data-link-type="dfn" href="https://w3c.github.io/picture-in-picture/#exit-picture-in-picture-algorithm">exit Picture-in-Picture algorithm</a> with <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document④">active document</a>.</p>
       </ol>
     </ol>
   </ol>
   <h3 class="heading settled" data-level="6.5" id="one-pip-window"><span class="secno">6.5. </span><span class="content">One PiP Window</span><a class="self-link" href="#one-pip-window"></a></h3>
   <p>Any <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top③">top-level traversable</a> must have at most one document
picture-in-picture window open at a time. If a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top④">top-level traversable</a> whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window" id="ref-for-nav-window③">active window</a>’s <a data-link-type="dfn" href="#window-documentpictureinpicture-api" id="ref-for-window-documentpictureinpicture-api①">documentPictureInPicture API</a>’s <a data-link-type="dfn" href="#documentpictureinpicture-last-opened-window" id="ref-for-documentpictureinpicture-last-opened-window③">last-opened window</a> is not <code>null</code> tries to open another
document picture-in-picture window, the user agent must close the existing <a data-link-type="dfn" href="#documentpictureinpicture-last-opened-window" id="ref-for-documentpictureinpicture-last-opened-window④">last-opened window</a> as described in the <a data-link-type="functionish" href="#dom-documentpictureinpicture-requestwindow" id="ref-for-dom-documentpictureinpicture-requestwindow④">requestWindow()</a> method
steps.</p>
   <p>However, whether only one window is allowed in Picture-in-Picture mode across
all <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top⑤">top-level traversables</a> is left to the implementation and the platform.
As such, what happens when there is a Picture-in-Picture request while there is
a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top⑥">top-level traversable</a> whose <a data-link-type="dfn" href="#is-document-picture-in-picture" id="ref-for-is-document-picture-in-picture④">Is Document Picture-in-Picture</a> boolean is <code>true</code> or whose <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document⑤">active document</a>’s <a data-link-type="idl" href="https://w3c.github.io/picture-in-picture/#dom-documentorshadowroot-pictureinpictureelement">pictureInPictureElement</a> is not <code>null</code> will be left as an implementation detail: the user
agent could <a data-link-type="dfn" href="#close-any-existing-picture-in-picture-windows" id="ref-for-close-any-existing-picture-in-picture-windows①">close any existing picture-in-picture windows</a> or multiple
Picture-in-Picture windows could be created.</p>
   <h3 class="heading settled" data-level="6.6" id="close-on-destroy"><span class="secno">6.6. </span><span class="content">Closing the PiP window when either the original or PiP document is destroyed</span><a class="self-link" href="#close-on-destroy"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="close-any-associated-document-picture-in-picture-windows">close any associated Document Picture-in-Picture windows</dfn> given a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document②">Document</a></code> <var>document</var>:</p>
   <ol>
    <li data-md>
     <p>Let <var>navigable</var> be <var>document</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable" id="ref-for-node-navigable">node navigable</a>.</p>
    <li data-md>
     <p>If <var>navigable</var> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top⑦">top-level traversable</a>, abort these steps.</p>
    <li data-md>
     <p>If <var>navigable</var>’s <a data-link-type="dfn" href="#is-document-picture-in-picture" id="ref-for-is-document-picture-in-picture⑤">Is Document Picture-in-Picture</a> boolean is <code>true</code>, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/#close-a-top-level-traversable">close</a> <var>navigable</var> and abort these steps.</p>
    <li data-md>
     <p>Let <var>win</var> be <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window" id="ref-for-nav-window④">active window</a>’s <a data-link-type="dfn" href="#window-documentpictureinpicture-api" id="ref-for-window-documentpictureinpicture-api②">documentPictureInPicture API</a>’s <a data-link-type="dfn" href="#documentpictureinpicture-last-opened-window" id="ref-for-documentpictureinpicture-last-opened-window⑤">last-opened window</a>.</p>
    <li data-md>
     <p>If <var>win</var> is not <code>null</code> and <var>win</var>’s <a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-closed" id="ref-for-dom-window-closed②">closed</a> attribute is <code>false</code>, then <a data-link-type="dfn" href="https://html.spec.whatwg.org/#close-a-top-level-traversable">close</a> <var>win</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable" id="ref-for-window-navigable④">navigable</a>.</p>
   </ol>
   <p class="issue" id="issue-3577df2d"><a class="self-link" href="#issue-3577df2d"></a> Merge this into <a data-link-type="dfn" href="https://html.spec.whatwg.org/#destroying-documents">destroy</a> once it has enough consensus. </p>
   <p>Add a step 10 to the end of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#destroying-documents">destroy</a>:</p>
   <ol start="5">
    <li data-md>
     <p><a data-link-type="dfn" href="#close-any-associated-document-picture-in-picture-windows" id="ref-for-close-any-associated-document-picture-in-picture-windows">Close any associated Document Picture-in-Picture windows</a> given <var>document</var>.</p>
   </ol>
   <p class="note" role="note"> This ensures that when a page with an open Document Picture-in-Picture window is
closed, then its PiP window is closed as well. </p>
   <h3 class="heading settled" data-level="6.7" id="close-on-navigate"><span class="secno">6.7. </span><span class="content">Closing the PiP window when either the original or PiP document is navigated</span><a class="self-link" href="#close-on-navigate"></a></h3>
   <p class="issue" id="issue-6b8b7377"><a class="self-link" href="#issue-6b8b7377"></a> Merge this into <a data-link-type="dfn" href="https://html.spec.whatwg.org/#navigate">navigate</a> once it has enough consensus. </p>
   <p>Modify step 16.3 of <a data-link-type="dfn" href="https://html.spec.whatwg.org/#navigate">navigate</a>,
"Queue a global task on the navigation and traversal task source given navigable’s active window to abort navigable’s active document.",
and also insert a step 16.4 immediately after it:</p>
   <ol start="3">
    <li data-md>
     <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task" id="ref-for-queue-a-global-task①">Queue a global task</a> on the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#navigation-and-traversal-task-source">navigation and traversal task source</a> given <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window" id="ref-for-nav-window⑤">active window</a> to <a data-link-type="dfn" href="https://html.spec.whatwg.org/#abort-a-document">abort</a> <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document⑥">active document</a> and <a data-link-type="dfn" href="#close-any-associated-document-picture-in-picture-windows" id="ref-for-close-any-associated-document-picture-in-picture-windows①">close any associated Document Picture-in-Picture windows</a> given <var>navigable</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document" id="ref-for-nav-document⑦">active document</a>.</p>
    <li data-md>
     <p>If <var>navigable</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top⑧">top-level traversable</a> whose <a data-link-type="dfn" href="#is-document-picture-in-picture" id="ref-for-is-document-picture-in-picture⑥">Is Document Picture-in-Picture</a> boolean is <code>true</code>, then
abort these steps.</p>
   </ol>
   <p class="note" role="note"> This ensures that when a page with an open Document Picture-in-Picture window is
navigated, then its PiP window is closed as well. It also ensures that when the
document in a Document Picture-in-Picture window is navigated, the Document
Picture-in-Picture window is closed. </p>
   <h3 class="heading settled" data-level="6.8" id="resizing-the-pip-window"><span class="secno">6.8. </span><span class="content">Resizing the PiP window</span><a class="self-link" href="#resizing-the-pip-window"></a></h3>
   <p> While programmatically resizing a document picture-in-picture window can be
useful, the always-on-top nature of the window means an unrestricted ability
to resize the window could be abused in annoying or intrusive way. To mitigate
these concerns without completely preventing the use of window resize APIs, we
will have those APIs consume a user gesture for document picture-in-picture
windows. </p>
   <p class="issue" id="issue-3197c07d"><a class="self-link" href="#issue-3197c07d"></a> Merge this into <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-resizeto" id="ref-for-dom-window-resizeto">resizeTo()</a></code> once it has enough consensus. </p>
   <p>Add a new step to <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-resizeto" id="ref-for-dom-window-resizeto①">resizeTo()</a></code> after step 3, "If <var>target</var> is not an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context" id="ref-for-auxiliary-browsing-context">auxiliary browsing context</a> that was created by a script (as opposed to by an
action of the user), then return.":</p>
   <ol start="4">
    <li data-md>
     <p>If <var>target</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top⑨">top-level traversable</a>’s <a data-link-type="dfn" href="#is-document-picture-in-picture" id="ref-for-is-document-picture-in-picture⑦">Is Document Picture-in-Picture</a> boolean is <code>true</code>, then:</p>
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①①">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑥">relevant global object</a> does not have <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation①">transient activation</a>, throw a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror③">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation" id="ref-for-consume-user-activation①">Consume user activation</a> given <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①②">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑦">relevant global object</a>.</p>
     </ol>
   </ol>
   <p class="issue" id="issue-2596317f"><a class="self-link" href="#issue-2596317f"></a> Merge this into <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-resizeby" id="ref-for-dom-window-resizeby">resizeBy()</a></code> once it has enough consensus. </p>
   <p>Add a new step to <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-resizeby" id="ref-for-dom-window-resizeby①">resizeBy()</a></code> after step 3, "If <var>target</var> is not an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context" id="ref-for-auxiliary-browsing-context①">auxiliary browsing context</a> that was created by a script (as opposed to by an
action of the user), then return.":</p>
   <ol start="4">
    <li data-md>
     <p>If <var>target</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top①⓪">top-level traversable</a>’s <a data-link-type="dfn" href="#is-document-picture-in-picture" id="ref-for-is-document-picture-in-picture⑧">Is Document Picture-in-Picture</a> boolean is <code>true</code>, then:</p>
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①③">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑧">relevant global object</a> does not have <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation②">transient activation</a>, throw a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror④">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation" id="ref-for-consume-user-activation②">Consume user activation</a> given <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①④">this</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global⑨">relevant global object</a>.</p>
     </ol>
   </ol>
   <h3 class="heading settled" data-level="6.9" id="focusing-the-opener-window"><span class="secno">6.9. </span><span class="content">Focusing the opener window</span><a class="self-link" href="#focusing-the-opener-window"></a></h3>
   <p> It can often be useful for the picture-in-picture window to be able to re-focus
its opener tab, e.g. when the smaller form-factor of the window doesn’t fit the
experience the user needs. We modify the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/interaction.html#dom-window-focus" id="ref-for-dom-window-focus">focus()</a></code> API to allow it to
take system-level focus when a picture-in-picture window is focusing its
opener. </p>
   <p class="issue" id="issue-603497c9"><a class="self-link" href="#issue-603497c9"></a> Merge this into <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/interaction.html#dom-window-focus" id="ref-for-dom-window-focus①">focus()</a></code> once it has enough consensus. </p>
   <p>Add a new step to <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/interaction.html#dom-window-focus" id="ref-for-dom-window-focus②">focus()</a></code> after step 3, "Run the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps" id="ref-for-focusing-steps">focusing steps</a> with <var>current</var>.":</p>
   <ol start="4">
    <li data-md>
     <p>If <var>current</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top" id="ref-for-nav-top①①">top-level traversable</a>, then:</p>
     <ol>
      <li data-md>
       <p>Let <var>pipWindow</var> be <var>current</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window" id="ref-for-nav-window⑥">active window</a>’s <a data-link-type="dfn" href="#window-documentpictureinpicture-api" id="ref-for-window-documentpictureinpicture-api③">documentPictureInPicture API</a>’s <a data-link-type="dfn" href="#documentpictureinpicture-last-opened-window" id="ref-for-documentpictureinpicture-last-opened-window⑥">last-opened window</a>.</p>
      <li data-md>
       <p>If <var>pipWindow</var> is not <code>null</code> and <var>pipWindow</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①⓪">relevant global object</a> has <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation③">transient activation</a>, then:</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation" id="ref-for-consume-user-activation③">Consume user activation</a> given <var>pipWindow</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①①">relevant global object</a>.</p>
        <li data-md>
         <p>Give <var>current</var> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#system-focus" id="ref-for-system-focus">system focus</a>.</p>
       </ol>
     </ol>
   </ol>
   <p class="note" role="note"> Giving system focus to the opener does not necessarily need to close the
document picture-in-picture window. If the website wants to close the document
picture-in-picture window after focusing, they can always do so using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-close" id="ref-for-dom-window-close">close()</a></code> on the document picture-in-picture window itself. </p>
   <h3 class="heading settled" data-level="6.10" id="css-display-mode"><span class="secno">6.10. </span><span class="content">CSS display-mode</span><a class="self-link" href="#css-display-mode"></a></h3>
   <p> The CSS display mode media feature <a data-link-type="dfn" href="https://drafts.csswg.org/mediaqueries-5/#display-mode-picture-in-picture" id="ref-for-display-mode-picture-in-picture">picture-in-picture</a> lets web developers
write specific CSS rules that are only applied when (part of the) the web app is shown in
picture-in-picture mode. </p>
   <h2 class="heading settled" data-level="7" id="examples"><span class="secno">7. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <p><em>This section is non-normative</em></p>
   <h3 class="heading settled" data-level="7.1" id="example-video-player"><span class="secno">7.1. </span><span class="content">Extracting a video player into PiP</span><a class="self-link" href="#example-video-player"></a></h3>
   <h4 class="heading settled" data-level="7.1.1" id="example-video-player-html"><span class="secno">7.1.1. </span><span class="content">HTML</span><a class="self-link" href="#example-video-player-html"></a></h4>
<pre class="lang-html highlight"><c- p>&lt;</c-><c- f>body</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"player-container"</c-><c- p>></c->
    <c- p>&lt;</c-><c- f>div</c-> <c- e>id</c-><c- o>=</c-><c- s>"player"</c-><c- p>></c->
      <c- p>&lt;</c-><c- f>video</c-> <c- e>id</c-><c- o>=</c-><c- s>"video"</c-> <c- e>src</c-><c- o>=</c-><c- s>"foo.webm"</c-><c- p>>&lt;/</c-><c- f>video</c-><c- p>></c->
      <c- d>&lt;!-- More player elements here. --></c->
    <c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>input</c-> <c- e>type</c-><c- o>=</c-><c- s>"button"</c-> <c- e>onclick</c-><c- o>=</c-><c- s>"enterPiP();"</c-> <c- e>value</c-><c- o>=</c-><c- s>"Enter PiP"</c-> <c- p>/></c->
<c- p>&lt;/</c-><c- f>body</c-><c- p>></c->
</pre>
   <h4 class="heading settled" data-level="7.1.2" id="example-video-player-js"><span class="secno">7.1.2. </span><span class="content">JavaScript</span><a class="self-link" href="#example-video-player-js"></a></h4>
<pre class="lang-javascript highlight"><c- c1>// Handle to the picture-in-picture window.</c->
<c- a>let</c-> pipWindow <c- o>=</c-> <c- kc>null</c-><c- p>;</c->

<c- a>function</c-> enterPiP<c- p>()</c-> <c- p>{</c->
  <c- a>const</c-> player <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- t>'#player'</c-><c- p>);</c->

  <c- c1>// Set the width/height so the window is properly sized to the video.</c->
  <c- a>const</c-> pipOptions <c- o>=</c-> <c- p>{</c->
    width<c- o>:</c-> player<c- p>.</c->clientWidth<c- p>,</c->
    height<c- o>:</c-> player<c- p>.</c->clientHeight<c- p>,</c->
  <c- p>};</c->

  documentPictureInPicture<c- p>.</c->requestWindow<c- p>(</c->pipOptions<c- p>).</c->then<c- p>((</c->pipWin<c- p>)</c-> <c- p>=></c-> <c- p>{</c->
    pipWindow <c- o>=</c-> pipWin<c- p>;</c->

    <c- c1>// Style remaining container to imply the player is in PiP.</c->
    playerContainer<c- p>.</c->classList<c- p>.</c->add<c- p>(</c-><c- t>'pip-mode'</c-><c- p>);</c->

    <c- c1>// Add player to the PiP window.</c->
    pipWindow<c- p>.</c->document<c- p>.</c->body<c- p>.</c->append<c- p>(</c->player<c- p>);</c->

    <c- c1>// Listen for the PiP closing event to put the video back.</c->
    pipWindow<c- p>.</c->addEventListener<c- p>(</c-><c- t>'pagehide'</c-><c- p>,</c-> onLeavePiP<c- p>.</c->bind<c- p>(</c->pipWindow<c- p>),</c-> <c- p>{</c-> once<c- o>:</c-> <c- kc>true</c-> <c- p>});</c->
  <c- p>});</c->
<c- p>}</c->

<c- c1>// Called when the PiP window has closed.</c->
<c- a>function</c-> onLeavePiP<c- p>()</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c-><c- k>this</c-> <c- o>!==</c-> pipWindow<c- p>)</c-> <c- p>{</c->
    <c- k>return</c-><c- p>;</c->
  <c- p>}</c->

  <c- c1>// Remove PiP styling from the container.</c->
  <c- a>const</c-> playerContainer <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- t>'#player-container'</c-><c- p>);</c->
  playerContainer<c- p>.</c->classList<c- p>.</c->remove<c- p>(</c-><c- t>'pip-mode'</c-><c- p>);</c->

  <c- c1>// Add the player back to the main window.</c->
  <c- a>const</c-> player <c- o>=</c-> pipWindow<c- p>.</c->document<c- p>.</c->querySelector<c- p>(</c-><c- t>'#player'</c-><c- p>);</c->
  playerContainer<c- p>.</c->append<c- p>(</c->player<c- p>);</c->

  pipWindow <c- o>=</c-> <c- kc>null</c-><c- p>;</c->
<c- p>}</c->
</pre>
   <h3 class="heading settled" data-level="7.2" id="example-access-elements"><span class="secno">7.2. </span><span class="content">Accessing elements on the PiP Window</span><a class="self-link" href="#example-access-elements"></a></h3>
<pre class="lang-javascript highlight"><c- a>const</c-> video <c- o>=</c-> pipWindow<c- p>.</c->document<c- p>.</c->querySelector<c- p>(</c-><c- t>'#video'</c-><c- p>);</c->
video<c- p>.</c->loop <c- o>=</c-> <c- kc>true</c-><c- p>;</c->
</pre>
   <h3 class="heading settled" data-level="7.3" id="example-listen-events"><span class="secno">7.3. </span><span class="content">Listening to events on the PiP Window</span><a class="self-link" href="#example-listen-events"></a></h3>
   <p>As part of creating an improved picture-in-picture experience, websites will often want
customize buttons and controls that need to respond to user input events such as clicks.</p>
<pre class="lang-javascript highlight"><c- a>const</c-> pipDocument <c- o>=</c-> pipWindow<c- p>.</c->document<c- p>;</c->
<c- a>const</c-> video <c- o>=</c-> pipDocument<c- p>.</c->querySelector<c- p>(</c-><c- t>'#video'</c-><c- p>);</c->
<c- a>const</c-> muteButton <c- o>=</c-> pipDocument<c- p>.</c->document<c- p>.</c->createElement<c- p>(</c-><c- t>'button'</c-><c- p>);</c->
muteButton<c- p>.</c->textContent <c- o>=</c-> <c- t>'Toggle mute'</c-><c- p>;</c->
muteButton<c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  video<c- p>.</c->muted <c- o>=</c-> <c- o>!</c->video<c- p>.</c->muted<c- p>;</c->
<c- p>});</c->
pipDocument<c- p>.</c->body<c- p>.</c->append<c- p>(</c->muteButton<c- p>);</c->
</pre>
   <h3 class="heading settled" data-level="7.4" id="example-exiting-pip"><span class="secno">7.4. </span><span class="content">Exiting PiP</span><a class="self-link" href="#example-exiting-pip"></a></h3>
   <p>The website may want to close the <code class="idl"><a data-link-type="idl" href="#documentpictureinpicture" id="ref-for-documentpictureinpicture⑧">DocumentPictureInPicture</a></code> <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①②">Window</a></code> without the user explicitly clicking on the window’s close button. They can do
this by using the <a class="idl-code" data-link-type="method" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-close" id="ref-for-dom-window-close①">close()</a> method on the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①③">Window</a></code> object:</p>
<pre class="lang-javascript highlight"><c- c1>// This will close the PiP window and trigger our existing onLeavePiP()</c->
<c- c1>// listener.</c->
pipWindow<c- p>.</c->close<c- p>();</c->
</pre>
   <h3 class="heading settled" data-level="7.5" id="example-elements-out-on-close"><span class="secno">7.5. </span><span class="content">Getting elements out of the PiP window when it closes</span><a class="self-link" href="#example-elements-out-on-close"></a></h3>
   <p>When the PiP window is closed for any reason (either because the website
initiated it or the user closed it), the website will often want to get the
elements back out of the PiP window. The website can perform this in an event
handler for the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/indices.html#event-pagehide" id="ref-for-event-pagehide">pagehide</a></code> event on the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①④">Window</a></code> object. This is shown in the <code>onLeavePiP()</code> handler in <a href="#example-video-player">video player example</a> above and is copied
below:</p>
<pre class="lang-javascript highlight"><c- c1>// Called when the PiP window has closed.</c->
<c- a>function</c-> onLeavePiP<c- p>()</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c-><c- k>this</c-> <c- o>!==</c-> pipWindow<c- p>)</c-> <c- p>{</c->
    <c- k>return</c-><c- p>;</c->
  <c- p>}</c->

  <c- c1>// Remove PiP styling from the container.</c->
  <c- a>const</c-> playerContainer <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- t>'#player-container'</c-><c- p>);</c->
  playerContainer<c- p>.</c->classList<c- p>.</c->remove<c- p>(</c-><c- t>'pip-mode'</c-><c- p>);</c->

  <c- c1>// Add the player back to the main window.</c->
  <c- a>const</c-> player <c- o>=</c-> pipWindow<c- p>.</c->document<c- p>.</c->querySelector<c- p>(</c-><c- t>'#player'</c-><c- p>);</c->
  playerContainer<c- p>.</c->append<c- p>(</c->player<c- p>);</c->

  pipWindow <c- o>=</c-> <c- kc>null</c-><c- p>;</c->
<c- p>}</c->
</pre>
   <h3 class="heading settled" data-level="7.6" id="example-programmatic-resize"><span class="secno">7.6. </span><span class="content">Programatically resize the PiP window</span><a class="self-link" href="#example-programmatic-resize"></a></h3>
   <p>The document picture-in-picture window supports the <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-resizeto" id="ref-for-dom-window-resizeto②">resizeTo()</a></code> and <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-resizeby" id="ref-for-dom-window-resizeby②">resizeBy()</a></code> APIs, but only with a user gesture on the PiP window:</p>
<pre class="lang-javascript highlight"><c- a>const</c-> expandButton <c- o>=</c-> pipWindow<c- p>.</c->document<c- p>.</c->createElement<c- p>(</c-><c- t>'button'</c-><c- p>);</c->
expandButton<c- p>.</c->textContent <c- o>=</c-> <c- t>'Expand PiP Window'</c-><c- p>;</c->
expandButton<c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  <c- c1>// Expand the PiP window’s width by 20px and height by 30px.</c->
  pipWindow<c- p>.</c->resizeBy<c- p>(</c-><c- mf>20</c-><c- p>,</c-> <c- mf>30</c-><c- p>);</c->
<c- p>});</c->
pipWindow<c- p>.</c->document<c- p>.</c->body<c- p>.</c->append<c- p>(</c->expandButton<c- p>);</c->
</pre>
   <h3 class="heading settled" data-level="7.7" id="example-return-to-tab"><span class="secno">7.7. </span><span class="content">Return to the opener tab</span><a class="self-link" href="#example-return-to-tab"></a></h3>
   <p>The <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/interaction.html#dom-window-focus" id="ref-for-dom-window-focus③">focus()</a></code> API can be used to focus the opener tab from a
picture-in-picture window (requiring a user gesture):</p>
<pre class="lang-javascript highlight"><c- a>const</c-> returnToTabButton <c- o>=</c-> pipWindow<c- p>.</c->document<c- p>.</c->createElement<c- p>(</c-><c- t>'button'</c-><c- p>);</c->
returnToTabButton<c- p>.</c->textContent <c- o>=</c-> <c- t>'Return to opener tab'</c-><c- p>;</c->
returnToTabButton<c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
  window<c- p>.</c->focus<c- p>();</c->
<c- p>});</c->
pipWindow<c- p>.</c->document<c- p>.</c->body<c- p>.</c->append<c- p>(</c->returnToTabButton<c- p>);</c->
</pre>
   <h3 class="heading settled" data-level="7.8" id="example-display-mode"><span class="secno">7.8. </span><span class="content">CSS picture-in-picture display mode usage</span><a class="self-link" href="#example-display-mode"></a></h3>
   <p>The following example shows how to remove margins on the body element
and reduce the font size of titles in PiP window to better fit the
content in question inside the PiP window:</p>
<pre class="lang-css highlight"><c- n>@media</c-> all and <c- p>(</c->display-mode: picture-in-picture<c- p>)</c-> <c- p>{</c->
  body <c- p>{</c->
    <c- k>margin</c-><c- p>:</c-> <c- m>0</c-><c- p>;</c->
  <c- p>}</c->
  h1 <c- p>{</c->
    <c- k>font-size</c-><c- p>:</c-> <c- m>0.8</c-><c- k>em</c-><c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   <h3 class="heading settled" data-level="7.9" id="example-hide-return-to-opener"><span class="secno">7.9. </span><span class="content">Hide return-to-opener button</span><a class="self-link" href="#example-hide-return-to-opener"></a></h3>
   <p>While user agents often display a button on their video and document
picture-in-picture windows to return to the opener and close the window,
this button doesn’t always make sense for some websites' document
picture-in-picture experience. Use the <code class="idl"><a data-link-type="idl" href="#dom-documentpictureinpictureoptions-allowreturntoopener" id="ref-for-dom-documentpictureinpictureoptions-allowreturntoopener②">allowReturnToOpener</a></code> option to hide the button.</p>
<pre class="lang-javascript highlight">documentPictureInPicture<c- p>.</c->requestWindow<c- p>({</c-> allowReturnToOpener<c- o>:</c-> <c- kc>false</c-> <c- p>});</c->
</pre>
   <h2 class="heading settled" data-level="8" id="acknowledgments"><span class="secno">8. </span><span class="content">Acknowledgments</span><a class="self-link" href="#acknowledgments"></a></h2>
   <p>Many thanks to Frank Liberato, Mark Foltz, Klaus Weidner, François Beaufort,
Charlie Reis, Joe DeBlasio, Domenic Denicola, and Yiren Wang for their comments
and contributions to this document and to the discussions that have informed it.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-documentpictureinpictureoptions-allowreturntoopener">allowReturnToOpener</a><span>, in § 5</span>
   <li><a href="#close-any-associated-document-picture-in-picture-windows">close any associated Document Picture-in-Picture windows</a><span>, in § 6.6</span>
   <li><a href="#close-any-existing-picture-in-picture-windows">close any existing picture-in-picture windows</a><span>, in § 6.4</span>
   <li><a href="#dom-documentpictureinpictureevent-documentpictureinpictureevent">constructor(type, eventInitDict)</a><span>, in § 5</span>
   <li><a href="#documentpictureinpicture">DocumentPictureInPicture</a><span>, in § 5</span>
   <li><a href="#dom-window-documentpictureinpicture">documentPictureInPicture</a><span>, in § 5</span>
   <li><a href="#window-documentpictureinpicture-api">documentPictureInPicture API</a><span>, in § 5</span>
   <li><a href="#documentpictureinpictureevent">DocumentPictureInPictureEvent</a><span>, in § 5</span>
   <li><a href="#dictdef-documentpictureinpictureeventinit">DocumentPictureInPictureEventInit</a><span>, in § 5</span>
   <li><a href="#dom-documentpictureinpictureevent-documentpictureinpictureevent">DocumentPictureInPictureEvent(type, eventInitDict)</a><span>, in § 5</span>
   <li><a href="#dictdef-documentpictureinpictureoptions">DocumentPictureInPictureOptions</a><span>, in § 5</span>
   <li><a href="#document-picture-in-picture-support">Document Picture-in-Picture Support</a><span>, in § 6.1</span>
   <li><a href="#eventdef-documentpictureinpicture-enter">enter</a><span>, in § 5</span>
   <li><a href="#dom-documentpictureinpictureoptions-height">height</a><span>, in § 5</span>
   <li><a href="#is-document-picture-in-picture">Is Document Picture-in-Picture</a><span>, in § 6.2</span>
   <li><a href="#documentpictureinpicture-last-opened-window">last-opened window</a><span>, in § 5</span>
   <li><a href="#dom-documentpictureinpicture-onenter">onenter</a><span>, in § 5</span>
   <li><a href="#dom-documentpictureinpicture-requestwindow">requestWindow()</a><span>, in § 5</span>
   <li><a href="#dom-documentpictureinpicture-requestwindow">requestWindow(options)</a><span>, in § 5</span>
   <li><a href="#dom-documentpictureinpictureoptions-width">width</a><span>, in § 5</span>
   <li>
    window
    <ul>
     <li><a href="#dom-documentpictureinpicture-window">attribute for DocumentPictureInPicture</a><span>, in § 5</span>
     <li><a href="#dom-documentpictureinpictureevent-window">attribute for DocumentPictureInPictureEvent</a><span>, in § 5</span>
     <li><a href="#dom-documentpictureinpictureeventinit-window">dict-member for DocumentPictureInPictureEventInit</a><span>, in § 5</span>
    </ul>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSSOM-VIEW-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="157f6644">moveBy(x, y)</span>
     <li><span class="dfn-paneled" id="27215c6e">moveTo(x, y)</span>
     <li><span class="dfn-paneled" id="fd03704d">resizeBy(x, y)</span>
     <li><span class="dfn-paneled" id="887ff352">resizeTo(width, height)</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="85394472">Document</span>
     <li><span class="dfn-paneled" id="129bdae8">Event</span>
     <li><span class="dfn-paneled" id="44a7708c">EventInit</span>
     <li><span class="dfn-paneled" id="2bc0cdf4">EventTarget</span>
     <li><span class="dfn-paneled" id="5fd23811">fire an event</span>
     <li><span class="dfn-paneled" id="347e8fe9">url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f0951476">EventHandler</span>
     <li><span class="dfn-paneled" id="10e25f42">HTMLIFrameElement</span>
     <li><span class="dfn-paneled" id="f57f330b">HTMLVideoElement</span>
     <li><span class="dfn-paneled" id="5d7209e9">Window</span>
     <li><span class="dfn-paneled" id="55a6b830">active browsing context</span>
     <li><span class="dfn-paneled" id="35972864">active document</span>
     <li><span class="dfn-paneled" id="101c721c">active window</span>
     <li><span class="dfn-paneled" id="58ebefde">auxiliary browsing context</span>
     <li><span class="dfn-paneled" id="0e1e41a8">close()</span>
     <li><span class="dfn-paneled" id="fab043c9">closed</span>
     <li><span class="dfn-paneled" id="aca22383">consume user activation</span>
     <li><span class="dfn-paneled" id="82529e79">descendant navigables</span>
     <li><span class="dfn-paneled" id="6eb8a5d8">document base url</span>
     <li><span class="dfn-paneled" id="240893a8">focus()</span>
     <li><span class="dfn-paneled" id="fe07e8b2">focusing steps</span>
     <li><span class="dfn-paneled" id="228be966">navigable</span>
     <li><span class="dfn-paneled" id="13dd6cae">node navigable</span>
     <li><span class="dfn-paneled" id="f449d4f8">open(url, target, features)</span>
     <li><span class="dfn-paneled" id="324be8d3">pagehide</span>
     <li><span class="dfn-paneled" id="48438eb3">queue a global task</span>
     <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
     <li><span class="dfn-paneled" id="124a994b">system focus</span>
     <li><span class="dfn-paneled" id="30717154">top-level traversable</span>
     <li><span class="dfn-paneled" id="47fe679e">transient activation</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="860300d4">implementation-defined</span>
    </ul>
   <li>
    <a data-link-type="biblio">[MEDIAQUERIES-5]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="fd018e6b">picture-in-picture</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="8855a9aa">DOMString</span>
     <li><span class="dfn-paneled" id="c01cbda0">EnforceRange</span>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="c807e273">NewObject</span>
     <li><span class="dfn-paneled" id="ba556545">NotAllowedError</span>
     <li><span class="dfn-paneled" id="3182eb71">NotSupportedError</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="ec878a66">RangeError</span>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="5372cca8">boolean</span>
     <li><span class="dfn-paneled" id="4013a022">this</span>
     <li><span class="dfn-paneled" id="f14b47b8">unsigned long long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-cssom-view-1">[CSSOM-VIEW-1]
   <dd>Simon Pieters. <a href="https://drafts.csswg.org/cssom-view/"><cite>CSSOM View Module</cite></a>. URL: <a href="https://drafts.csswg.org/cssom-view/">https://drafts.csswg.org/cssom-view/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-mediaqueries-5">[MEDIAQUERIES-5]
   <dd>Dean Jackson; et al. <a href="https://drafts.csswg.org/mediaqueries-5/"><cite>Media Queries Level 5</cite></a>. URL: <a href="https://drafts.csswg.org/mediaqueries-5/">https://drafts.csswg.org/mediaqueries-5/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-secure-contexts">[SECURE-CONTEXTS]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-secure-contexts/"><cite>Secure Contexts</cite></a>. URL: <a href="https://w3c.github.io/webappsec-secure-contexts/">https://w3c.github.io/webappsec-secure-contexts/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><c- g>Window</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#documentpictureinpicture"><c- n>DocumentPictureInPicture</c-></a>
    <a class="idl-code" data-link-type="attribute" data-readonly data-type="DocumentPictureInPicture" href="#dom-window-documentpictureinpicture"><c- g>documentPictureInPicture</c-></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <a href="#documentpictureinpicture"><code><c- g>DocumentPictureInPicture</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget"><c- n>EventTarget</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#NewObject"><c- g>NewObject</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><c- n>Window</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-documentpictureinpicture-requestwindow"><c- g>requestWindow</c-></a>(
    <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-documentpictureinpictureoptions"><c- n>DocumentPictureInPictureOptions</c-></a> <a href="#dom-documentpictureinpicture-requestwindow-options-options"><code><c- g>options</c-></code></a> = {});
  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><c- n>Window</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="Window" href="#dom-documentpictureinpicture-window"><c- g>window</c-></a>;
  <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a data-type="EventHandler" href="#dom-documentpictureinpicture-onenter"><code><c- g>onenter</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-documentpictureinpictureoptions"><code><c- g>DocumentPictureInPictureOptions</c-></code></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-default="0" data-type="unsigned long long" href="#dom-documentpictureinpictureoptions-width"><code><c- g>width</c-></code></a> = 0;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a data-default="0" data-type="unsigned long long" href="#dom-documentpictureinpictureoptions-height"><code><c- g>height</c-></code></a> = 0;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-default="true" data-type="boolean" href="#dom-documentpictureinpictureoptions-allowreturntoopener"><code><c- g>allowReturnToOpener</c-></code></a> = <c- b>true</c->;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>]
<c- b>interface</c-> <a href="#documentpictureinpictureevent"><code><c- g>DocumentPictureInPictureEvent</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event"><c- n>Event</c-></a> {
  <a href="#dom-documentpictureinpictureevent-documentpictureinpictureevent"><code><c- g>constructor</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-documentpictureinpictureevent-documentpictureinpictureevent-type-eventinitdict-type"><code><c- g>type</c-></code></a>, <a data-link-type="idl-name" href="#dictdef-documentpictureinpictureeventinit"><c- n>DocumentPictureInPictureEventInit</c-></a> <a href="#dom-documentpictureinpictureevent-documentpictureinpictureevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code></a>);
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><c- n>Window</c-></a> <a data-readonly data-type="Window" href="#dom-documentpictureinpictureevent-window"><code><c- g>window</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-documentpictureinpictureeventinit"><code><c- g>DocumentPictureInPictureEventInit</c-></code></a> : <a data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit"><c- n>EventInit</c-></a> {
  <c- b>required</c-> <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"><c- n>Window</c-></a> <a data-type="Window" href="#dom-documentpictureinpictureeventinit-window"><code><c- g>window</c-></code></a>;
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Merge this into <a data-link-type="dfn" href="https://html.spec.whatwg.org/#close-a-top-level-traversable">close</a> once it has enough consensus. <a class="issue-return" href="#issue-52892068" title="Jump to section">↵</a></div>
   <div class="issue"> Merge this into <a data-link-type="dfn" href="https://html.spec.whatwg.org/#destroying-documents">destroy</a> once it has enough consensus. <a class="issue-return" href="#issue-3577df2d" title="Jump to section">↵</a></div>
   <div class="issue"> Merge this into <a data-link-type="dfn" href="https://html.spec.whatwg.org/#navigate">navigate</a> once it has enough consensus. <a class="issue-return" href="#issue-6b8b7377" title="Jump to section">↵</a></div>
   <div class="issue"> Merge this into <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-resizeto">resizeTo()</a></code> once it has enough consensus. <a class="issue-return" href="#issue-3197c07d" title="Jump to section">↵</a></div>
   <div class="issue"> Merge this into <code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-window-resizeby">resizeBy()</a></code> once it has enough consensus. <a class="issue-return" href="#issue-2596317f" title="Jump to section">↵</a></div>
   <div class="issue"> Merge this into <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/interaction.html#dom-window-focus">focus()</a></code> once it has enough consensus. <a class="issue-return" href="#issue-603497c9" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0e1e41a8": {"dfnID":"0e1e41a8","dfnText":"close()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-window-close"}],"title":"6.9. Focusing the opener window"},{"refs":[{"id":"ref-for-dom-window-close\u2460"}],"title":"7.4. Exiting PiP"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-close"},
"101c721c": {"dfnID":"101c721c","dfnText":"active window","external":true,"refSections":[{"refs":[{"id":"ref-for-nav-window"},{"id":"ref-for-nav-window\u2460"},{"id":"ref-for-nav-window\u2461"}],"title":"5. API"},{"refs":[{"id":"ref-for-nav-window\u2462"}],"title":"6.5. One PiP Window"},{"refs":[{"id":"ref-for-nav-window\u2463"}],"title":"6.6. Closing the PiP window when either the original or PiP document is destroyed"},{"refs":[{"id":"ref-for-nav-window\u2464"}],"title":"6.7. Closing the PiP window when either the original or PiP document is navigated"},{"refs":[{"id":"ref-for-nav-window\u2465"}],"title":"6.9. Focusing the opener window"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window"},
"10e25f42": {"dfnID":"10e25f42","dfnText":"HTMLIFrameElement","external":true,"refSections":[{"refs":[{"id":"ref-for-htmliframeelement"},{"id":"ref-for-htmliframeelement\u2460"}],"title":"3.3. IFrames"}],"url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement"},
"124a994b": {"dfnID":"124a994b","dfnText":"system focus","external":true,"refSections":[{"refs":[{"id":"ref-for-system-focus"}],"title":"6.9. Focusing the opener window"}],"url":"https://html.spec.whatwg.org/multipage/interaction.html#system-focus"},
"129bdae8": {"dfnID":"129bdae8","dfnText":"Event","external":true,"refSections":[{"refs":[{"id":"ref-for-event"}],"title":"5. API"}],"url":"https://dom.spec.whatwg.org/#event"},
"13dd6cae": {"dfnID":"13dd6cae","dfnText":"node navigable","external":true,"refSections":[{"refs":[{"id":"ref-for-node-navigable"}],"title":"6.6. Closing the PiP window when either the original or PiP document is destroyed"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable"},
"157f6644": {"dfnID":"157f6644","dfnText":"moveBy(x, y)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-window-moveby"}],"title":"3.2.1. Positioning"}],"url":"https://drafts.csswg.org/cssom-view-1/#dom-window-moveby"},
"228be966": {"dfnID":"228be966","dfnText":"navigable","external":true,"refSections":[{"refs":[{"id":"ref-for-window-navigable"},{"id":"ref-for-window-navigable\u2460"},{"id":"ref-for-window-navigable\u2461"},{"id":"ref-for-window-navigable\u2462"}],"title":"5. API"},{"refs":[{"id":"ref-for-window-navigable\u2463"}],"title":"6.6. Closing the PiP window when either the original or PiP document is destroyed"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable"},
"240893a8": {"dfnID":"240893a8","dfnText":"focus()","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-window-focus"},{"id":"ref-for-dom-window-focus\u2460"},{"id":"ref-for-dom-window-focus\u2461"}],"title":"6.9. Focusing the opener window"},{"refs":[{"id":"ref-for-dom-window-focus\u2462"}],"title":"7.7. Return to the opener tab"}],"url":"https://html.spec.whatwg.org/multipage/interaction.html#dom-window-focus"},
"27215c6e": {"dfnID":"27215c6e","dfnText":"moveTo(x, y)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-window-moveto"}],"title":"3.2.1. Positioning"}],"url":"https://drafts.csswg.org/cssom-view-1/#dom-window-moveto"},
"2bc0cdf4": {"dfnID":"2bc0cdf4","dfnText":"EventTarget","external":true,"refSections":[{"refs":[{"id":"ref-for-eventtarget"}],"title":"5. API"}],"url":"https://dom.spec.whatwg.org/#eventtarget"},
"30717154": {"dfnID":"30717154","dfnText":"top-level traversable","external":true,"refSections":[{"refs":[{"id":"ref-for-nav-top"}],"title":"3.3. IFrames"},{"refs":[{"id":"ref-for-nav-top\u2460"}],"title":"5. API"},{"refs":[{"id":"ref-for-nav-top\u2461"}],"title":"6.2. DocumentPictureInPicture Window"},{"refs":[{"id":"ref-for-nav-top\u2462"},{"id":"ref-for-nav-top\u2463"},{"id":"ref-for-nav-top\u2464"},{"id":"ref-for-nav-top\u2465"}],"title":"6.5. One PiP Window"},{"refs":[{"id":"ref-for-nav-top\u2466"}],"title":"6.6. Closing the PiP window when either the original or PiP document is destroyed"},{"refs":[{"id":"ref-for-nav-top\u2467"}],"title":"6.7. Closing the PiP window when either the original or PiP document is navigated"},{"refs":[{"id":"ref-for-nav-top\u2468"},{"id":"ref-for-nav-top\u2460\u24ea"}],"title":"6.8. Resizing the PiP window"},{"refs":[{"id":"ref-for-nav-top\u2460\u2460"}],"title":"6.9. Focusing the opener window"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top"},
"3182eb71": {"dfnID":"3182eb71","dfnText":"NotSupportedError","external":true,"refSections":[{"refs":[{"id":"ref-for-notsupportederror"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#notsupportederror"},
"324be8d3": {"dfnID":"324be8d3","dfnText":"pagehide","external":true,"refSections":[{"refs":[{"id":"ref-for-event-pagehide"}],"title":"7.5. Getting elements out of the PiP window when it closes"}],"url":"https://html.spec.whatwg.org/multipage/indices.html#event-pagehide"},
"347e8fe9": {"dfnID":"347e8fe9","dfnText":"url","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-document-url"}],"title":"5. API"}],"url":"https://dom.spec.whatwg.org/#concept-document-url"},
"35972864": {"dfnID":"35972864","dfnText":"active document","external":true,"refSections":[{"refs":[{"id":"ref-for-nav-document"},{"id":"ref-for-nav-document\u2460"},{"id":"ref-for-nav-document\u2461"},{"id":"ref-for-nav-document\u2462"},{"id":"ref-for-nav-document\u2463"}],"title":"6.4. Close any existing PiP windows"},{"refs":[{"id":"ref-for-nav-document\u2464"}],"title":"6.5. One PiP Window"},{"refs":[{"id":"ref-for-nav-document\u2465"},{"id":"ref-for-nav-document\u2466"}],"title":"6.7. Closing the PiP window when either the original or PiP document is navigated"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"},
"4013a022": {"dfnID":"4013a022","dfnText":"this","external":true,"refSections":[{"refs":[{"id":"ref-for-this"},{"id":"ref-for-this\u2460"},{"id":"ref-for-this\u2461"},{"id":"ref-for-this\u2462"},{"id":"ref-for-this\u2463"},{"id":"ref-for-this\u2464"},{"id":"ref-for-this\u2465"},{"id":"ref-for-this\u2466"},{"id":"ref-for-this\u2467"},{"id":"ref-for-this\u2468"},{"id":"ref-for-this\u2460\u24ea"}],"title":"5. API"},{"refs":[{"id":"ref-for-this\u2460\u2460"},{"id":"ref-for-this\u2460\u2461"},{"id":"ref-for-this\u2460\u2462"},{"id":"ref-for-this\u2460\u2463"}],"title":"6.8. Resizing the PiP window"}],"url":"https://webidl.spec.whatwg.org/#this"},
"44a7708c": {"dfnID":"44a7708c","dfnText":"EventInit","external":true,"refSections":[{"refs":[{"id":"ref-for-dictdef-eventinit"}],"title":"5. API"}],"url":"https://dom.spec.whatwg.org/#dictdef-eventinit"},
"47fe679e": {"dfnID":"47fe679e","dfnText":"transient activation","external":true,"refSections":[{"refs":[{"id":"ref-for-transient-activation"}],"title":"5. API"},{"refs":[{"id":"ref-for-transient-activation\u2460"},{"id":"ref-for-transient-activation\u2461"}],"title":"6.8. Resizing the PiP window"},{"refs":[{"id":"ref-for-transient-activation\u2462"}],"title":"6.9. Focusing the opener window"}],"url":"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation"},
"48438eb3": {"dfnID":"48438eb3","dfnText":"queue a global task","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-a-global-task"}],"title":"5. API"},{"refs":[{"id":"ref-for-queue-a-global-task\u2460"}],"title":"6.7. Closing the PiP window when either the original or PiP document is navigated"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"},
"5372cca8": {"dfnID":"5372cca8","dfnText":"boolean","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-boolean"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#idl-boolean"},
"55a6b830": {"dfnID":"55a6b830","dfnText":"active browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-nav-bc"},{"id":"ref-for-nav-bc\u2460"},{"id":"ref-for-nav-bc\u2461"},{"id":"ref-for-nav-bc\u2462"}],"title":"5. API"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc"},
"58ebefde": {"dfnID":"58ebefde","dfnText":"auxiliary browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-auxiliary-browsing-context"},{"id":"ref-for-auxiliary-browsing-context\u2460"}],"title":"6.8. Resizing the PiP window"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context"},
"5d7209e9": {"dfnID":"5d7209e9","dfnText":"Window","external":true,"refSections":[{"refs":[{"id":"ref-for-window"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-window\u2460"}],"title":"3.3. IFrames"},{"refs":[{"id":"ref-for-window\u2461"},{"id":"ref-for-window\u2462"},{"id":"ref-for-window\u2463"},{"id":"ref-for-window\u2464"},{"id":"ref-for-window\u2465"},{"id":"ref-for-window\u2466"},{"id":"ref-for-window\u2467"},{"id":"ref-for-window\u2468"},{"id":"ref-for-window\u2460\u24ea"},{"id":"ref-for-window\u2460\u2460"}],"title":"5. API"},{"refs":[{"id":"ref-for-window\u2460\u2461"},{"id":"ref-for-window\u2460\u2462"}],"title":"7.4. Exiting PiP"},{"refs":[{"id":"ref-for-window\u2460\u2463"}],"title":"7.5. Getting elements out of the PiP window when it closes"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"},
"5fd23811": {"dfnID":"5fd23811","dfnText":"fire an event","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-event-fire"}],"title":"5. API"}],"url":"https://dom.spec.whatwg.org/#concept-event-fire"},
"6eb8a5d8": {"dfnID":"6eb8a5d8","dfnText":"document base url","external":true,"refSections":[{"refs":[{"id":"ref-for-document-base-url"}],"title":"5. API"}],"url":"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#document-base-url"},
"82529e79": {"dfnID":"82529e79","dfnText":"descendant navigables","external":true,"refSections":[{"refs":[{"id":"ref-for-descendant-navigables"}],"title":"6.4. Close any existing PiP windows"}],"url":"https://html.spec.whatwg.org/multipage/document-sequences.html#descendant-navigables"},
"85394472": {"dfnID":"85394472","dfnText":"Document","external":true,"refSections":[{"refs":[{"id":"ref-for-document"}],"title":"1. Introduction"},{"refs":[{"id":"ref-for-document\u2460"}],"title":"5. API"},{"refs":[{"id":"ref-for-document\u2461"}],"title":"6.6. Closing the PiP window when either the original or PiP document is destroyed"}],"url":"https://dom.spec.whatwg.org/#document"},
"860300d4": {"dfnID":"860300d4","dfnText":"implementation-defined","external":true,"refSections":[{"refs":[{"id":"ref-for-implementation-defined"}],"title":"6.1. Document Picture-in-Picture Support"}],"url":"https://infra.spec.whatwg.org/#implementation-defined"},
"8855a9aa": {"dfnID":"8855a9aa","dfnText":"DOMString","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMString"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"887ff352": {"dfnID":"887ff352","dfnText":"resizeTo(width, height)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-window-resizeto"},{"id":"ref-for-dom-window-resizeto\u2460"}],"title":"6.8. Resizing the PiP window"},{"refs":[{"id":"ref-for-dom-window-resizeto\u2461"}],"title":"7.6. Programatically resize the PiP window"}],"url":"https://drafts.csswg.org/cssom-view-1/#dom-window-resizeto"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"},{"id":"ref-for-Exposed\u2460"},{"id":"ref-for-Exposed\u2461"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"a5c91173": {"dfnID":"a5c91173","dfnText":"SameObject","external":true,"refSections":[{"refs":[{"id":"ref-for-SameObject"},{"id":"ref-for-SameObject\u2460"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#SameObject"},
"aca22383": {"dfnID":"aca22383","dfnText":"consume user activation","external":true,"refSections":[{"refs":[{"id":"ref-for-consume-user-activation"}],"title":"5. API"},{"refs":[{"id":"ref-for-consume-user-activation\u2460"},{"id":"ref-for-consume-user-activation\u2461"}],"title":"6.8. Resizing the PiP window"},{"refs":[{"id":"ref-for-consume-user-activation\u2462"}],"title":"6.9. Focusing the opener window"}],"url":"https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation"},
"b75bb3bd": {"dfnID":"b75bb3bd","dfnText":"SecureContext","external":true,"refSections":[{"refs":[{"id":"ref-for-SecureContext"},{"id":"ref-for-SecureContext\u2460"},{"id":"ref-for-SecureContext\u2461"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#SecureContext"},
"ba556545": {"dfnID":"ba556545","dfnText":"NotAllowedError","external":true,"refSections":[{"refs":[{"id":"ref-for-notallowederror"},{"id":"ref-for-notallowederror\u2460"},{"id":"ref-for-notallowederror\u2461"}],"title":"5. API"},{"refs":[{"id":"ref-for-notallowederror\u2462"},{"id":"ref-for-notallowederror\u2463"}],"title":"6.8. Resizing the PiP window"}],"url":"https://webidl.spec.whatwg.org/#notallowederror"},
"bdbd19d1": {"dfnID":"bdbd19d1","dfnText":"Promise","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-promise"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#idl-promise"},
"c01cbda0": {"dfnID":"c01cbda0","dfnText":"EnforceRange","external":true,"refSections":[{"refs":[{"id":"ref-for-EnforceRange"},{"id":"ref-for-EnforceRange\u2460"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#EnforceRange"},
"c807e273": {"dfnID":"c807e273","dfnText":"NewObject","external":true,"refSections":[{"refs":[{"id":"ref-for-NewObject"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#NewObject"},
"close-any-associated-document-picture-in-picture-windows": {"dfnID":"close-any-associated-document-picture-in-picture-windows","dfnText":"close any associated Document Picture-in-Picture windows","external":false,"refSections":[{"refs":[{"id":"ref-for-close-any-associated-document-picture-in-picture-windows"}],"title":"6.6. Closing the PiP window when either the original or PiP document is destroyed"},{"refs":[{"id":"ref-for-close-any-associated-document-picture-in-picture-windows\u2460"}],"title":"6.7. Closing the PiP window when either the original or PiP document is navigated"}],"url":"#close-any-associated-document-picture-in-picture-windows"},
"close-any-existing-picture-in-picture-windows": {"dfnID":"close-any-existing-picture-in-picture-windows","dfnText":"close any existing picture-in-picture windows","external":false,"refSections":[{"refs":[{"id":"ref-for-close-any-existing-picture-in-picture-windows"}],"title":"5. API"},{"refs":[{"id":"ref-for-close-any-existing-picture-in-picture-windows\u2460"}],"title":"6.5. One PiP Window"}],"url":"#close-any-existing-picture-in-picture-windows"},
"dca2de17": {"dfnID":"dca2de17","dfnText":"DOMException","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-DOMException"},{"id":"ref-for-idl-DOMException\u2460"},{"id":"ref-for-idl-DOMException\u2461"},{"id":"ref-for-idl-DOMException\u2462"}],"title":"5. API"},{"refs":[{"id":"ref-for-idl-DOMException\u2463"},{"id":"ref-for-idl-DOMException\u2464"}],"title":"6.8. Resizing the PiP window"}],"url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"dictdef-documentpictureinpictureeventinit": {"dfnID":"dictdef-documentpictureinpictureeventinit","dfnText":"DocumentPictureInPictureEventInit","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-documentpictureinpictureeventinit"}],"title":"5. API"}],"url":"#dictdef-documentpictureinpictureeventinit"},
"dictdef-documentpictureinpictureoptions": {"dfnID":"dictdef-documentpictureinpictureoptions","dfnText":"DocumentPictureInPictureOptions","external":false,"refSections":[{"refs":[{"id":"ref-for-dictdef-documentpictureinpictureoptions"}],"title":"5. API"}],"url":"#dictdef-documentpictureinpictureoptions"},
"document-picture-in-picture-support": {"dfnID":"document-picture-in-picture-support","dfnText":"Document Picture-in-Picture Support","external":false,"refSections":[{"refs":[{"id":"ref-for-document-picture-in-picture-support"}],"title":"5. API"}],"url":"#document-picture-in-picture-support"},
"documentpictureinpicture": {"dfnID":"documentpictureinpicture","dfnText":"DocumentPictureInPicture","external":false,"refSections":[{"refs":[{"id":"ref-for-documentpictureinpicture"}],"title":"3.2. Spoofing"},{"refs":[{"id":"ref-for-documentpictureinpicture\u2460"}],"title":"3.2.2. Origin Visibility"},{"refs":[{"id":"ref-for-documentpictureinpicture\u2461"}],"title":"3.3. IFrames"},{"refs":[{"id":"ref-for-documentpictureinpicture\u2462"},{"id":"ref-for-documentpictureinpicture\u2463"},{"id":"ref-for-documentpictureinpicture\u2464"},{"id":"ref-for-documentpictureinpicture\u2465"},{"id":"ref-for-documentpictureinpicture\u2466"}],"title":"5. API"},{"refs":[{"id":"ref-for-documentpictureinpicture\u2467"}],"title":"7.4. Exiting PiP"}],"url":"#documentpictureinpicture"},
"documentpictureinpicture-last-opened-window": {"dfnID":"documentpictureinpicture-last-opened-window","dfnText":"last-opened window","external":false,"refSections":[{"refs":[{"id":"ref-for-documentpictureinpicture-last-opened-window"},{"id":"ref-for-documentpictureinpicture-last-opened-window\u2460"},{"id":"ref-for-documentpictureinpicture-last-opened-window\u2461"}],"title":"5. API"},{"refs":[{"id":"ref-for-documentpictureinpicture-last-opened-window\u2462"},{"id":"ref-for-documentpictureinpicture-last-opened-window\u2463"}],"title":"6.5. One PiP Window"},{"refs":[{"id":"ref-for-documentpictureinpicture-last-opened-window\u2464"}],"title":"6.6. Closing the PiP window when either the original or PiP document is destroyed"},{"refs":[{"id":"ref-for-documentpictureinpicture-last-opened-window\u2465"}],"title":"6.9. Focusing the opener window"}],"url":"#documentpictureinpicture-last-opened-window"},
"documentpictureinpictureevent": {"dfnID":"documentpictureinpictureevent","dfnText":"DocumentPictureInPictureEvent","external":false,"refSections":[{"refs":[{"id":"ref-for-documentpictureinpictureevent"}],"title":"5. API"}],"url":"#documentpictureinpictureevent"},
"dom-documentpictureinpicture-onenter": {"dfnID":"dom-documentpictureinpicture-onenter","dfnText":"onenter","external":false,"refSections":[],"url":"#dom-documentpictureinpicture-onenter"},
"dom-documentpictureinpicture-requestwindow": {"dfnID":"dom-documentpictureinpicture-requestwindow","dfnText":"requestWindow(options)","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-documentpictureinpicture-requestwindow"},{"id":"ref-for-dom-documentpictureinpicture-requestwindow\u2460"},{"id":"ref-for-dom-documentpictureinpicture-requestwindow\u2461"}],"title":"5. API"},{"refs":[{"id":"ref-for-dom-documentpictureinpicture-requestwindow\u2462"}],"title":"6.2. DocumentPictureInPicture Window"},{"refs":[{"id":"ref-for-dom-documentpictureinpicture-requestwindow\u2463"}],"title":"6.5. One PiP Window"}],"url":"#dom-documentpictureinpicture-requestwindow"},
"dom-documentpictureinpicture-requestwindow-options-options": {"dfnID":"dom-documentpictureinpicture-requestwindow-options-options","dfnText":"options","external":false,"refSections":[],"url":"#dom-documentpictureinpicture-requestwindow-options-options"},
"dom-documentpictureinpicture-window": {"dfnID":"dom-documentpictureinpicture-window","dfnText":"window","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-documentpictureinpicture-window"}],"title":"5. API"}],"url":"#dom-documentpictureinpicture-window"},
"dom-documentpictureinpictureevent-documentpictureinpictureevent": {"dfnID":"dom-documentpictureinpictureevent-documentpictureinpictureevent","dfnText":"constructor","external":false,"refSections":[],"url":"#dom-documentpictureinpictureevent-documentpictureinpictureevent"},
"dom-documentpictureinpictureevent-documentpictureinpictureevent-type-eventinitdict-eventinitdict": {"dfnID":"dom-documentpictureinpictureevent-documentpictureinpictureevent-type-eventinitdict-eventinitdict","dfnText":"eventInitDict","external":false,"refSections":[],"url":"#dom-documentpictureinpictureevent-documentpictureinpictureevent-type-eventinitdict-eventinitdict"},
"dom-documentpictureinpictureevent-documentpictureinpictureevent-type-eventinitdict-type": {"dfnID":"dom-documentpictureinpictureevent-documentpictureinpictureevent-type-eventinitdict-type","dfnText":"type","external":false,"refSections":[],"url":"#dom-documentpictureinpictureevent-documentpictureinpictureevent-type-eventinitdict-type"},
"dom-documentpictureinpictureevent-window": {"dfnID":"dom-documentpictureinpictureevent-window","dfnText":"window","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-documentpictureinpictureevent-window"}],"title":"5. API"}],"url":"#dom-documentpictureinpictureevent-window"},
"dom-documentpictureinpictureeventinit-window": {"dfnID":"dom-documentpictureinpictureeventinit-window","dfnText":"window","external":false,"refSections":[],"url":"#dom-documentpictureinpictureeventinit-window"},
"dom-documentpictureinpictureoptions-allowreturntoopener": {"dfnID":"dom-documentpictureinpictureoptions-allowreturntoopener","dfnText":"allowReturnToOpener","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-documentpictureinpictureoptions-allowreturntoopener"},{"id":"ref-for-dom-documentpictureinpictureoptions-allowreturntoopener\u2460"}],"title":"5. API"},{"refs":[{"id":"ref-for-dom-documentpictureinpictureoptions-allowreturntoopener\u2461"}],"title":"7.9. Hide return-to-opener button"}],"url":"#dom-documentpictureinpictureoptions-allowreturntoopener"},
"dom-documentpictureinpictureoptions-height": {"dfnID":"dom-documentpictureinpictureoptions-height","dfnText":"height","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-documentpictureinpictureoptions-height"},{"id":"ref-for-dom-documentpictureinpictureoptions-height\u2460"},{"id":"ref-for-dom-documentpictureinpictureoptions-height\u2461"},{"id":"ref-for-dom-documentpictureinpictureoptions-height\u2462"},{"id":"ref-for-dom-documentpictureinpictureoptions-height\u2463"}],"title":"5. API"}],"url":"#dom-documentpictureinpictureoptions-height"},
"dom-documentpictureinpictureoptions-width": {"dfnID":"dom-documentpictureinpictureoptions-width","dfnText":"width","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-documentpictureinpictureoptions-width"},{"id":"ref-for-dom-documentpictureinpictureoptions-width\u2460"},{"id":"ref-for-dom-documentpictureinpictureoptions-width\u2461"},{"id":"ref-for-dom-documentpictureinpictureoptions-width\u2462"},{"id":"ref-for-dom-documentpictureinpictureoptions-width\u2463"}],"title":"5. API"}],"url":"#dom-documentpictureinpictureoptions-width"},
"dom-window-documentpictureinpicture": {"dfnID":"dom-window-documentpictureinpicture","dfnText":"documentPictureInPicture","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-window-documentpictureinpicture"}],"title":"5. API"}],"url":"#dom-window-documentpictureinpicture"},
"e99bd18e": {"dfnID":"e99bd18e","dfnText":"relevant global object","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-relevant-global"},{"id":"ref-for-concept-relevant-global\u2460"},{"id":"ref-for-concept-relevant-global\u2461"},{"id":"ref-for-concept-relevant-global\u2462"},{"id":"ref-for-concept-relevant-global\u2463"},{"id":"ref-for-concept-relevant-global\u2464"}],"title":"5. API"},{"refs":[{"id":"ref-for-concept-relevant-global\u2465"},{"id":"ref-for-concept-relevant-global\u2466"},{"id":"ref-for-concept-relevant-global\u2467"},{"id":"ref-for-concept-relevant-global\u2468"}],"title":"6.8. Resizing the PiP window"},{"refs":[{"id":"ref-for-concept-relevant-global\u2460\u24ea"},{"id":"ref-for-concept-relevant-global\u2460\u2460"}],"title":"6.9. Focusing the opener window"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"},
"ec878a66": {"dfnID":"ec878a66","dfnText":"RangeError","external":true,"refSections":[{"refs":[{"id":"ref-for-exceptiondef-rangeerror"},{"id":"ref-for-exceptiondef-rangeerror\u2460"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror"},
"eventdef-documentpictureinpicture-enter": {"dfnID":"eventdef-documentpictureinpicture-enter","dfnText":"enter","external":false,"refSections":[{"refs":[{"id":"ref-for-eventdef-documentpictureinpicture-enter"}],"title":"5. API"}],"url":"#eventdef-documentpictureinpicture-enter"},
"f0951476": {"dfnID":"f0951476","dfnText":"EventHandler","external":true,"refSections":[{"refs":[{"id":"ref-for-eventhandler"}],"title":"5. API"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"},
"f14b47b8": {"dfnID":"f14b47b8","dfnText":"unsigned long long","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-unsigned-long-long"},{"id":"ref-for-idl-unsigned-long-long\u2460"}],"title":"5. API"}],"url":"https://webidl.spec.whatwg.org/#idl-unsigned-long-long"},
"f449d4f8": {"dfnID":"f449d4f8","dfnText":"open(url, target, features)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-open"}],"title":"1. Introduction"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-open"},
"f57f330b": {"dfnID":"f57f330b","dfnText":"HTMLVideoElement","external":true,"refSections":[{"refs":[{"id":"ref-for-htmlvideoelement"}],"title":"1. Introduction"}],"url":"https://html.spec.whatwg.org/multipage/media.html#htmlvideoelement"},
"fab043c9": {"dfnID":"fab043c9","dfnText":"closed","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-window-closed"},{"id":"ref-for-dom-window-closed\u2460"}],"title":"5. API"},{"refs":[{"id":"ref-for-dom-window-closed\u2461"}],"title":"6.6. Closing the PiP window when either the original or PiP document is destroyed"}],"url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-closed"},
"fd018e6b": {"dfnID":"fd018e6b","dfnText":"picture-in-picture","external":true,"refSections":[{"refs":[{"id":"ref-for-display-mode-picture-in-picture"}],"title":"6.10. CSS display-mode"}],"url":"https://drafts.csswg.org/mediaqueries-5/#display-mode-picture-in-picture"},
"fd03704d": {"dfnID":"fd03704d","dfnText":"resizeBy(x, y)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-window-resizeby"},{"id":"ref-for-dom-window-resizeby\u2460"}],"title":"6.8. Resizing the PiP window"},{"refs":[{"id":"ref-for-dom-window-resizeby\u2461"}],"title":"7.6. Programatically resize the PiP window"}],"url":"https://drafts.csswg.org/cssom-view-1/#dom-window-resizeby"},
"fe07e8b2": {"dfnID":"fe07e8b2","dfnText":"focusing steps","external":true,"refSections":[{"refs":[{"id":"ref-for-focusing-steps"}],"title":"6.9. Focusing the opener window"}],"url":"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps"},
"is-document-picture-in-picture": {"dfnID":"is-document-picture-in-picture","dfnText":"Is Document Picture-in-Picture","external":false,"refSections":[{"refs":[{"id":"ref-for-is-document-picture-in-picture"},{"id":"ref-for-is-document-picture-in-picture\u2460"}],"title":"5. API"},{"refs":[{"id":"ref-for-is-document-picture-in-picture\u2461"}],"title":"6.3. Closing a Document Picture-in-Picture window"},{"refs":[{"id":"ref-for-is-document-picture-in-picture\u2462"}],"title":"6.4. Close any existing PiP windows"},{"refs":[{"id":"ref-for-is-document-picture-in-picture\u2463"}],"title":"6.5. One PiP Window"},{"refs":[{"id":"ref-for-is-document-picture-in-picture\u2464"}],"title":"6.6. Closing the PiP window when either the original or PiP document is destroyed"},{"refs":[{"id":"ref-for-is-document-picture-in-picture\u2465"}],"title":"6.7. Closing the PiP window when either the original or PiP document is navigated"},{"refs":[{"id":"ref-for-is-document-picture-in-picture\u2466"},{"id":"ref-for-is-document-picture-in-picture\u2467"}],"title":"6.8. Resizing the PiP window"}],"url":"#is-document-picture-in-picture"},
"window-documentpictureinpicture-api": {"dfnID":"window-documentpictureinpicture-api","dfnText":"documentPictureInPicture API","external":false,"refSections":[{"refs":[{"id":"ref-for-window-documentpictureinpicture-api"}],"title":"5. API"},{"refs":[{"id":"ref-for-window-documentpictureinpicture-api\u2460"}],"title":"6.5. One PiP Window"},{"refs":[{"id":"ref-for-window-documentpictureinpicture-api\u2461"}],"title":"6.6. Closing the PiP window when either the original or PiP document is destroyed"},{"refs":[{"id":"ref-for-window-documentpictureinpicture-api\u2462"}],"title":"6.9. Focusing the opener window"}],"url":"#window-documentpictureinpicture-api"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#close-any-associated-document-picture-in-picture-windows": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"close any associated document picture-in-picture windows","type":"dfn","url":"#close-any-associated-document-picture-in-picture-windows"},
"#close-any-existing-picture-in-picture-windows": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"close any existing picture-in-picture windows","type":"dfn","url":"#close-any-existing-picture-in-picture-windows"},
"#dictdef-documentpictureinpictureeventinit": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"DocumentPictureInPictureEventInit","type":"dictionary","url":"#dictdef-documentpictureinpictureeventinit"},
"#dictdef-documentpictureinpictureoptions": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"DocumentPictureInPictureOptions","type":"dictionary","url":"#dictdef-documentpictureinpictureoptions"},
"#document-picture-in-picture-support": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"document picture-in-picture support","type":"dfn","url":"#document-picture-in-picture-support"},
"#documentpictureinpicture": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"DocumentPictureInPicture","type":"interface","url":"#documentpictureinpicture"},
"#documentpictureinpicture-last-opened-window": {"export":true,"for_":["DocumentPictureInPicture"],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"last-opened window","type":"dfn","url":"#documentpictureinpicture-last-opened-window"},
"#documentpictureinpictureevent": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"DocumentPictureInPictureEvent","type":"interface","url":"#documentpictureinpictureevent"},
"#dom-documentpictureinpicture-requestwindow": {"export":true,"for_":["DocumentPictureInPicture"],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"requestWindow(options)","type":"method","url":"#dom-documentpictureinpicture-requestwindow"},
"#dom-documentpictureinpicture-window": {"export":true,"for_":["DocumentPictureInPicture"],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"window","type":"attribute","url":"#dom-documentpictureinpicture-window"},
"#dom-documentpictureinpictureevent-window": {"export":true,"for_":["DocumentPictureInPictureEvent"],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"window","type":"attribute","url":"#dom-documentpictureinpictureevent-window"},
"#dom-documentpictureinpictureoptions-allowreturntoopener": {"export":true,"for_":["DocumentPictureInPictureOptions"],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"allowReturnToOpener","type":"dict-member","url":"#dom-documentpictureinpictureoptions-allowreturntoopener"},
"#dom-documentpictureinpictureoptions-height": {"export":true,"for_":["DocumentPictureInPictureOptions"],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"height","type":"dict-member","url":"#dom-documentpictureinpictureoptions-height"},
"#dom-documentpictureinpictureoptions-width": {"export":true,"for_":["DocumentPictureInPictureOptions"],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"width","type":"dict-member","url":"#dom-documentpictureinpictureoptions-width"},
"#dom-window-documentpictureinpicture": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"documentPictureInPicture","type":"attribute","url":"#dom-window-documentpictureinpicture"},
"#eventdef-documentpictureinpicture-enter": {"export":true,"for_":["DocumentPictureInPicture"],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"enter","type":"event","url":"#eventdef-documentpictureinpicture-enter"},
"#is-document-picture-in-picture": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"is document picture-in-picture","type":"dfn","url":"#is-document-picture-in-picture"},
"#window-documentpictureinpicture-api": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"document-pip-spec","spec":"document-pip-spec-1","status":"local","text":"documentpictureinpicture api","type":"dfn","url":"#window-documentpictureinpicture-api"},
"https://dom.spec.whatwg.org/#concept-document-url": {"export":true,"for_":["Document"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"url","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-document-url"},
"https://dom.spec.whatwg.org/#concept-event-fire": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"fire an event","type":"dfn","url":"https://dom.spec.whatwg.org/#concept-event-fire"},
"https://dom.spec.whatwg.org/#dictdef-eventinit": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"EventInit","type":"dictionary","url":"https://dom.spec.whatwg.org/#dictdef-eventinit"},
"https://dom.spec.whatwg.org/#document": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Document","type":"interface","url":"https://dom.spec.whatwg.org/#document"},
"https://dom.spec.whatwg.org/#event": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"Event","type":"interface","url":"https://dom.spec.whatwg.org/#event"},
"https://dom.spec.whatwg.org/#eventtarget": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"EventTarget","type":"interface","url":"https://dom.spec.whatwg.org/#eventtarget"},
"https://drafts.csswg.org/cssom-view-1/#dom-window-moveby": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"cssom-view","spec":"cssom-view-1","status":"current","text":"moveBy(x, y)","type":"method","url":"https://drafts.csswg.org/cssom-view-1/#dom-window-moveby"},
"https://drafts.csswg.org/cssom-view-1/#dom-window-moveto": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"cssom-view","spec":"cssom-view-1","status":"current","text":"moveTo(x, y)","type":"method","url":"https://drafts.csswg.org/cssom-view-1/#dom-window-moveto"},
"https://drafts.csswg.org/cssom-view-1/#dom-window-resizeby": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"cssom-view","spec":"cssom-view-1","status":"current","text":"resizeBy(x, y)","type":"method","url":"https://drafts.csswg.org/cssom-view-1/#dom-window-resizeby"},
"https://drafts.csswg.org/cssom-view-1/#dom-window-resizeto": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"cssom-view","spec":"cssom-view-1","status":"current","text":"resizeTo(width, height)","type":"method","url":"https://drafts.csswg.org/cssom-view-1/#dom-window-resizeto"},
"https://drafts.csswg.org/mediaqueries-5/#display-mode-picture-in-picture": {"export":true,"for_":["display mode"],"level":"5","normative":true,"shortname":"mediaqueries","spec":"mediaqueries-5","status":"current","text":"picture-in-picture","type":"dfn","url":"https://drafts.csswg.org/mediaqueries-5/#display-mode-picture-in-picture"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"auxiliary browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#descendant-navigables": {"export":true,"for_":["Document"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"descendant navigables","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#descendant-navigables"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc": {"export":true,"for_":["navigable"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"active browsing context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document": {"export":true,"for_":["navigable"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"active document","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top": {"export":true,"for_":["navigable"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"top-level traversable","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window": {"export":true,"for_":["navigable"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"active window","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window"},
"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"node navigable","type":"dfn","url":"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable"},
"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLIFrameElement","type":"interface","url":"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement"},
"https://html.spec.whatwg.org/multipage/indices.html#event-pagehide": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"pagehide","type":"event","url":"https://html.spec.whatwg.org/multipage/indices.html#event-pagehide"},
"https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"consume user activation","type":"dfn","url":"https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation"},
"https://html.spec.whatwg.org/multipage/interaction.html#dom-window-focus": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"focus()","type":"method","url":"https://html.spec.whatwg.org/multipage/interaction.html#dom-window-focus"},
"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"focusing steps","type":"dfn","url":"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps"},
"https://html.spec.whatwg.org/multipage/interaction.html#system-focus": {"export":true,"for_":["top-level traversable"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"system focus","type":"dfn","url":"https://html.spec.whatwg.org/multipage/interaction.html#system-focus"},
"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"transient activation","type":"dfn","url":"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation"},
"https://html.spec.whatwg.org/multipage/media.html#htmlvideoelement": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"HTMLVideoElement","type":"interface","url":"https://html.spec.whatwg.org/multipage/media.html#htmlvideoelement"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-open": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"open(url, target, features)","type":"method","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-open"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-close": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"close()","type":"method","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-close"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-closed": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"closed","type":"attribute","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-window-closed"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"Window","type":"interface","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window"},
"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable": {"export":true,"for_":["Window"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"navigable","type":"dfn","url":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable"},
"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#document-base-url": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"document base url","type":"dfn","url":"https://html.spec.whatwg.org/multipage/urls-and-fetching.html#document-base-url"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global"},
"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"EventHandler","type":"typedef","url":"https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"},
"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"queue a global task","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task"},
"https://infra.spec.whatwg.org/#implementation-defined": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"implementation-defined","type":"dfn","url":"https://infra.spec.whatwg.org/#implementation-defined"},
"https://webidl.spec.whatwg.org/#EnforceRange": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"EnforceRange","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#EnforceRange"},
"https://webidl.spec.whatwg.org/#Exposed": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#NewObject": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"NewObject","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#NewObject"},
"https://webidl.spec.whatwg.org/#SameObject": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SameObject","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SameObject"},
"https://webidl.spec.whatwg.org/#SecureContext": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SecureContext","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SecureContext"},
"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"RangeError","type":"exception","url":"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror"},
"https://webidl.spec.whatwg.org/#idl-DOMException": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMException","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMException"},
"https://webidl.spec.whatwg.org/#idl-DOMString": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"DOMString","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-DOMString"},
"https://webidl.spec.whatwg.org/#idl-boolean": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"boolean","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-boolean"},
"https://webidl.spec.whatwg.org/#idl-promise": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Promise","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-promise"},
"https://webidl.spec.whatwg.org/#idl-unsigned-long-long": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"unsigned long long","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-unsigned-long-long"},
"https://webidl.spec.whatwg.org/#notallowederror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"NotAllowedError","type":"exception","url":"https://webidl.spec.whatwg.org/#notallowederror"},
"https://webidl.spec.whatwg.org/#notsupportederror": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"NotSupportedError","type":"exception","url":"https://webidl.spec.whatwg.org/#notsupportederror"},
"https://webidl.spec.whatwg.org/#this": {"export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"this","type":"dfn","url":"https://webidl.spec.whatwg.org/#this"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.text != linkText) {
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.text)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const ref = refsData[url];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>